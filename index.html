<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خرید سکه - Meriko Games</title>
    <style>
        body {
            margin: 0;
            font-family: 'Vazir', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            text-align: center;
        }
        h1 { font-size: 2.5em; margin-bottom: 20px; }
        p { font-size: 1.2em; margin-bottom: 30px; }
        input[type="number"] {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
        }
        input::placeholder { color: rgba(255,255,255,0.7); }
        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
        }
        button:hover { background: #ff5252; transform: scale(1.05); }
        #coins {
            font-size: 2em;
            margin: 30px 0;
            font-weight: bold;
            color: #ffd700;
        }
        .loader { display: none; margin: 20px; color: #ffd700; }
    </style>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-wdth-normal.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>خرید سکه بازی</h1>
        <p>مبلغ دلخواه (تومان) وارد کن</p>
        <div id="coins">سکه فعلی: <span id="current">0</span></div>
        <input type="number" id="amount" placeholder="مثلاً ۱۰۰۰۰" min="1000">
        <button onclick="buy()">پرداخت با دارامت</button>
        <div class="loader" id="loader">در حال پردازش...</div>
    </div>

    <script>
        const userId = localStorage.getItem('userId') || crypto.randomUUID();
        localStorage.setItem('userId', userId);

        function loadCoins() {
            const coins = parseInt(localStorage.getItem('coins') || '0');
            document.getElementById('current').innerText = coins;
        }

        function buy() {
            const amount = parseInt(document.getElementById('amount').value);
            if (!amount || amount < 1000) return alert('مبلغ حداقل ۱۰۰۰ تومان');

            const currentUrl = window.location.origin + window.location.pathname;
            // مبلغ پیش‌پر شده + بازگشت به سایت خودت
            const donatUrl = `https://daramet.com/merikoGames?amount=\( {amount}&redirect_url= \){encodeURIComponent(currentUrl)}`;
            window.location.href = donatUrl;
        }

        // پردازش بازگشت از دارامت (بی‌صدا)
        const params = new URLSearchParams(window.location.search);
        const status = params.get('status');
        const paidAmount = params.get('amount');

        if (status === 'success' && paidAmount) {
            document.getElementById('loader').style.display = 'block';

            const amount = parseInt(paidAmount);
            let realAmount = amount * 2;              // دو برابر
            let coins = Math.floor(realAmount / 1000); // هر ۱۰۰۰ تومن = ۱ سکه
            coins = Math.floor(coins * 1.3);           // +۳۰% بونوس

            const currentCoins = parseInt(localStorage.getItem('coins') || '0');
            const newTotal = currentCoins + coins;

            localStorage.setItem('coins', newTotal);
            loadCoins();

            // فقط اینجا پیام موفقیت نشون بده
            alert(`پرداخت موفق! ${coins} سکه اضافه شد`);

            // پاک کردن پارامترها از آدرس
            history.replaceState({}, '', window.location.pathname);
            document.getElementById('loader').style.display = 'none';
        } else if (status === 'failed') {
            alert('پرداخت ناموفق بود');
            history.replaceState({}, '', window.location.pathname);
        }

        window.onload = loadCoins;
    </script>
</body>
</html>
