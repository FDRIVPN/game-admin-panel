<!DOCTYPE html> 
<html lang="fa" dir="rtl"> 
<head> 
  <meta charset="UTF-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/> 
  <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§Ø²ÛŒ</title> 
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/> 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/> 
  <style>
  :root {
    --primary: #6366f1;
    --danger: #ef4444;
    --success: #10b981;
    --dark: #1f2937;
    --light: #f9fafb;
  }
  .dark { background: #111827; color: #e5e7eb; }
  .card { transition: all 0.3s; cursor: pointer; }
  .card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); }
  .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
  .hidden { display: none; }
  .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 999; display: flex; justify-content: center; align-items: center; }
  .modal-content { background: #fff; padding: 24px; border-radius: 16px; max-width: 90%; max-height: 90%; overflow-y: auto; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
  .modal-dark { background: #1f2937; color: #e5e7eb; }

  /* ÙÙ‚Ø· Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ù† Ù‚Ø±Ù…Ø² Ø¨Ø´Ù† (Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ + Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„) */
  #btnShowBulkBan,
  #btnShowListBanned {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
  }
  #btnShowBulkBan:hover,
  #btnShowListBanned:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
    transform: translateY(-4px);
  }

  /* Ø¯Ø§Ø±Ú© Ù…ÙˆØ¯: Ù‚Ø±Ù…Ø² ØªÛŒØ±Ù‡ Ùˆ Ø®ÙˆØ§Ù†Ø§ */
  .dark #btnShowBulkBan,
  .dark #btnShowListBanned {
    background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%) !important;
  }
  .dark #btnShowBulkBan:hover,
  .dark #btnShowListBanned:hover {
    background: linear-gradient(135deg, #7f1d1d 0%, #450a0a 100%) !important;
  }

  /* Ú©Ø§Ø±Øª Ø¨Ù†â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§ Ù…Ø«Ù„ Ù‚Ø¨Ù„ Ø¨Ù…ÙˆÙ†Ù‡ (Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ù†Ø¯Ù‡) */
  #cardBannedNow { /* Ø¨Ø¯ÙˆÙ† !important Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ */ }

  /* Ù„ÛŒØ³Øª Ø¨Ù†â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø§Ø®Ù„ Ù…ÙˆØ¯Ø§Ù„ (Ù‚Ø±Ù…Ø² Ø´ÛŒÚ©) */
  .modal-content li.bg-red-50,
  .modal-content li[class*="bg-red"] {
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%) !important;
    border-left: 6px solid #ef4444 !important;
    color: #991b1b !important;
  }
  .dark .modal-content li.bg-red-50,
  .dark .modal-content li[class*="bg-red"] {
    background: linear-gradient(135deg, #450a0a 0%, #4c0519 100%) !important;
    border-left: 6px solid #f87171 !important;
    color: #fca5a5 !important;
  }
  .dark .modal-content li.bg-red-50 * { color: #fca5a5 !important; }

  /* Ø§Ø³Ú©Ø±ÙˆÙ„Ø¨Ø§Ø± Ø´ÛŒÚ© */
  ::-webkit-scrollbar { width: 10px; }
  ::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 10px; }
  ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 10px; }
  .dark ::-webkit-scrollbar-track { background: #374151; }
  .dark ::-webkit-scrollbar-thumb { background: #6b7280; }
</style>
</head> 
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen transition-colors"> 
  <div class="container mx-auto p-4 max-w-7xl"> 
    <header class="text-center mb-8"> 
      <h1 class="text-4xl font-bold gradient-bg bg-clip-text text-transparent">ğŸ® Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§Ø²ÛŒ</h1> 
      <p class="text-gray-600 dark:text-gray-400 mt-2">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†, Ø³Ú©Ù‡, Ø¨Ù† Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ, Ú¯Ù†Ø¬â€ŒÙ‡Ø§ Ùˆ Ú†Øªâ€ŒÙ‡Ø§</p> 
      <button id="themeToggle" class="mt-4 p-2 rounded-full bg-gray-200 dark:bg-gray-700"> 
        <i class="fas fa-moon"></i> 
      </button> 
    </header> 
    <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± (6 Ú©Ø§Ø±Øª) --> 
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8"> 
      <div id="cardTotalUsers" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col justify-between"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</p> 
          <p id="totalUsers" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-users text-4xl text-indigo-400 self-end"></i> 
      </div> 
      <div id="cardTotalActive" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col justify-between"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„</p> 
          <p id="totalActive" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-user-check text-4xl text-green-400 self-end"></i> 
      </div> 
      <div id="cardNewToday" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col justify-between"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ø¬Ø¯ÛŒØ¯ Ø§Ù…Ø±ÙˆØ²</p> 
          <p id="newToday" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-user-plus text-4xl text-yellow-400 self-end"></i> 
      </div> 
      <div id="cardTotalCoins" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col justify-between"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ú©Ù„ Ø³Ú©Ù‡â€ŒÙ‡Ø§</p> 
          <p id="totalCoins" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-coins text-4xl text-amber-400 self-end"></i> 
      </div> 
      <div id="cardBannedNow" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col justify-between"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ø¨Ù† Ø´Ø¯Ù‡â€ŒÙ‡Ø§</p> 
          <p id="bannedNow" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-ban text-4xl text-red-400 self-end"></i> 
      </div> 
      <div id="cardTotalAdmins" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col justify-between"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§</p> 
          <p id="totalAdmins" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-user-shield text-4xl text-purple-400 self-end"></i> 
      </div> 
    </div> 
    <!-- Ø¨Ø®Ø´ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹ --> 
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"> 
      <button id="btnShowRecentChats" class="bg-gradient-to-r from-blue-500 to-blue-700 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition flex items-center justify-center"> 
        <i class="fas fa-comments ml-2"></i> Ú†Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± 
      </button> 
      <button id="btnShowBulkBan" class="bg-gradient-to-r from-red-500 to-red-700 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition flex items-center justify-center"> 
        <i class="fas fa-users-slash ml-2"></i> Ø¨Ù† Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ (100 Ú©Ø§Ø±Ø¨Ø±) 
      </button> 
      <button id="btnShowListBanned" class="bg-gradient-to-r from-orange-500 to-orange-700 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition flex items-center justify-center"> 
        <i class="fas fa-list ml-2"></i> Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù† Ø´Ø¯Ù‡ 
      </button> 
    </div> 
    <!-- Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ù†Ø¬â€ŒÙ‡Ø§ --> 
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-8"> 
      <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-gem ml-2"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ù†Ø¬â€ŒÙ‡Ø§</h2> 
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡ Ùˆ Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø± (Ø¨Ù‡ Ø«Ø§Ù†ÛŒÙ‡) Ù‡Ø± Ú¯Ù†Ø¬ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.</p> 
      <div class="mb-4 flex flex-col md:flex-row gap-4"> 
        <input id="newTreasureName" type="text" placeholder="Ù†Ø§Ù… Ú¯Ù†Ø¬ Ø¬Ø¯ÛŒØ¯" class="flex-grow p-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"/> 
        <input id="newTreasureCoins" type="number" placeholder="Ø³Ú©Ù‡ Ø¬Ø§ÛŒØ²Ù‡" class="w-full md:w-28 p-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"/> 
        <input id="newTreasureDuration" type="number" placeholder="Ø²Ù…Ø§Ù† (Ø«Ø§Ù†ÛŒÙ‡)" class="w-full md:w-28 p-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"/> 
        <button id="addTreasureBtn" class="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition w-full md:w-auto flex items-center justify-center"> 
          <i class="fas fa-plus ml-2"></i> Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú¯Ù†Ø¬ 
        </button> 
      </div> 
      <div class="overflow-x-auto"> 
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"> 
          <thead class="bg-gray-50 dark:bg-gray-700"> 
            <tr> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ID Ú¯Ù†Ø¬</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ù†Ø§Ù…</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø³Ú©Ù‡ Ø¬Ø§ÛŒØ²Ù‡</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø²Ù…Ø§Ù† (Ø«Ø§Ù†ÛŒÙ‡)</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø¹Ù…Ù„ÛŒØ§Øª</th> 
            </tr> 
          </thead> 
          <tbody id="treasureListBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"> 
            <tr><td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400">Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ù†Ø¬â€ŒÙ‡Ø§...</td></tr> 
          </tbody> 
        </table> 
      </div> 
    </div> 
    <!-- Ø¬Ø³ØªØ¬Ùˆ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø± --> 
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-8"> 
      <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-search ml-2"></i> Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ú©Ø§Ø±Ø¨Ø±</h2> 
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ù†Ø§Ù… ÛŒØ§ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø´Ù†Ø§Ø³Ù‡ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯. Ø§Ú¯Ø± Ú†Ù†Ø¯ Ù†ØªÛŒØ¬Ù‡ Ø¨ÙˆØ¯ØŒ Ù‡Ù…Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p> 
      <div class="flex flex-col md:flex-row gap-4"> 
        <input id="userSearchInput" type="text" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø´Ù†Ø§Ø³Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." class="flex-grow p-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition"/> 
        <button id="searchButton" class="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition w-full md:w-auto flex items-center justify-center"> 
          <i class="fas fa-search ml-2"></i> Ø¬Ø³ØªØ¬Ùˆ 
        </button> 
      </div> 
      <!-- Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ --> 
      <div id="searchResults" class="hidden mt-4"> 
        <h3 class="font-bold mb-2">Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ:</h3> 
        <div id="searchResultsList" class="space-y-2"></div> 
      </div> 
    </div> 
    <!-- Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø± --> 
    <div id="userDetails" class="hidden bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-8"> 
      <h2 class="text-2xl font-bold mb-4 text-indigo-600 dark:text-indigo-400 flex items-center"><i class="fas fa-user-circle ml-2"></i> Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø±: <span id="userName" class="mr-1"></span></h2> 
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6"> 
        <div class="col-span-1 md:col-span-4 border-b pb-4 mb-4"> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ø´Ù†Ø§Ø³Ù‡: <span id="detailId" class="text-gray-900 dark:text-white font-mono text-sm"></span></p> 
          <p class="text-sm text-gray-500 dark:text-gray-400">ØªØ§Ø±ÛŒØ® Ø³Ø§Ø®Øª: <span id="detailCreatedAt" class="text-gray-900 dark:text-white text-sm"></span></p> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯: <span id="detailLastLogin" class="text-gray-900 dark:text-white text-sm"></span></p> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ú©Ø¯ Ø¯Ø¹ÙˆØª: <span id="detailReferral" class="text-gray-900 dark:text-white font-mono text-sm"></span></p> 
          <p class="text-sm text-gray-500 dark:text-gray-400 flex items-center"> ÙˆØ¶Ø¹ÛŒØª: <span id="detailActive" class="mr-1 font-bold"></span> <span id="detailAdmin" class="text-xs mr-2 p-1 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"></span> </p> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ø¨Ù† ØªØ§: <span id="detailBan" class="text-red-500 font-bold"></span></p> 
        </div> 
        <div class="p-4 border dark:border-gray-700 rounded-lg col-span-1 md:col-span-2"> 
          <h3 class="font-semibold mb-3">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ (Ù†Ø§Ù…, Ø³Ú©Ù‡, Ø´ØºÙ„)</h3> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯ (<span id="currentName"></span>)</label> 
            <input id="editName" type="text" placeholder="Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯ (Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯)" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ø³Ú©Ù‡â€ŒÙ‡Ø§ (<span id="currentCoins">0</span>)</label> 
            <input id="editCoins" type="number" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø³Ú©Ù‡" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ø´ØºÙ„ (<span id="currentJob">Ø¨ÛŒÚ©Ø§Ø±</span>)</label> 
            <input id="editJob" type="text" placeholder="Ø´ØºÙ„ Ø¬Ø¯ÛŒØ¯" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <button id="updateInfoButton" class="bg-green-600 text-white p-2 rounded-lg hover:bg-green-700 transition w-full mt-2"> 
            <i class="fas fa-save ml-2"></i> Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª 
          </button> 
          <button id="viewNameHistoryButton" class="bg-gray-600 text-white p-2 rounded-lg hover:bg-gray-700 transition w-full mt-2"> 
            <i class="fas fa-history ml-2"></i> ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§ 
          </button> 
        </div> 
        <div class="p-4 border dark:border-gray-700 rounded-lg"> 
          <h3 class="font-semibold mb-3">Ø³Ø·Ø­/ØªØ¬Ø±Ø¨Ù‡</h3> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ø³Ø·Ø­ (<span id="currentLevel">1</span>)</label> 
            <input id="editLevel" type="number" placeholder="Ø³Ø·Ø­ Ø¬Ø¯ÛŒØ¯" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">ØªØ¬Ø±Ø¨Ù‡ (<span id="currentExp">0</span>)</label> 
            <input id="editExp" type="number" placeholder="ØªØ¬Ø±Ø¨Ù‡ Ø¬Ø¯ÛŒØ¯" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <button id="updateLevelExpButton" class="bg-yellow-600 text-white p-2 rounded-lg hover:bg-yellow-700 transition w-full mt-2"> 
            <i class="fas fa-level-up-alt ml-2"></i> Ø°Ø®ÛŒØ±Ù‡ Ø³Ø·Ø­/ØªØ¬Ø±Ø¨Ù‡ 
          </button> 
        </div> 
        <div class="p-4 border border-red-300 dark:border-red-700 rounded-lg bg-red-50 dark:bg-red-900"> 
          <h3 class="font-semibold mb-3 text-red-600 dark:text-red-400">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ/Ú†Øª</h3> 
          <button id="viewChatHistoryButton" class="bg-indigo-700 text-white p-2 rounded-lg hover:bg-indigo-800 transition w-full mb-3"> 
            <i class="fas fa-comments ml-2"></i> Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª 
          </button> 
          <hr class="my-3 border-red-500 dark:border-red-600"> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¨Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</label> 
            <input id="banMinutes" type="number" placeholder="Ù…Ø«Ø§Ù„: 240 (4 Ø³Ø§Ø¹Øª)" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <button id="banButton" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700 transition w-full mt-2"> 
            <i class="fas fa-hammer ml-2"></i> Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù† 
          </button> 
          <button id="unbanButton" class="bg-gray-600 text-white p-2 rounded-lg hover:bg-gray-700 transition w-full mt-2"> 
            <i class="fas fa-undo-alt ml-2"></i> Ø­Ø°Ù Ø¨Ù† 
          </button> 
          <button id="toggleAdminButton" class="bg-yellow-800 text-white p-2 rounded-lg hover:bg-yellow-900 transition w-full mt-2"> 
            <i class="fas fa-user-shield ml-2"></i> ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø§Ø¯Ù…ÛŒÙ† 
          </button> 
          <button id="toggleActiveButton" class="bg-purple-800 text-white p-2 rounded-lg hover:bg-purple-900 transition w-full mt-2"> 
            <i class="fas fa-power-off ml-2"></i> ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† 
          </button> 
          <button id="deleteButton" class="bg-red-800 text-white p-2 rounded-lg hover:bg-red-900 transition w-full mt-4"> 
            <i class="fas fa-trash-alt ml-2"></i> Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø± (ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª) 
          </button> 
        </div> 
      </div> 
    </div> 
    <!-- Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø®ÛŒØ± --> 
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg"> 
      <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-table ml-2"></i> Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø®ÛŒØ± (<span id="userCount">...</span>)</h2> 
      <div class="overflow-x-auto"> 
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"> 
          <thead class="bg-gray-50 dark:bg-gray-700"> 
            <tr> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ID / Ù†Ø§Ù…</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø³Ú©Ù‡</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø³Ø·Ø­ / Ø´ØºÙ„</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ØªØ§Ø±ÛŒØ® Ø³Ø§Ø®Øª</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ÙˆØ¶Ø¹ÛŒØª</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø¹Ù…Ù„ÛŒØ§Øª</th> 
            </tr> 
          </thead> 
          <tbody id="userListBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"> 
            <tr><td colspan="7" class="p-4 text-center text-gray-500 dark:text-gray-400">Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td></tr> 
          </tbody> 
        </table> 
      </div> 
      <div class="flex justify-between items-center mt-4"> 
        <div id="pageInfo" class="text-sm text-gray-600 dark:text-gray-400"></div> 
        <div> 
          <button id="prevPageButton" class="px-4 py-2 text-sm font-medium rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition" disabled> Ù‚Ø¨Ù„ÛŒ </button> 
          <button id="nextPageButton" class="px-4 py-2 text-sm font-medium rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition mr-2" disabled> Ø¨Ø¹Ø¯ÛŒ </button> 
        </div> 
      </div> 
    </div> 
  </div> 
  <div id="modalContainer" class="hidden"></div> 
  <script> 
    const API_BASE = window.location.origin; 
    let currentPage = 1; 
    const limit = 20; 
    let currentUserData = null; 

    // ================================================================= 
    // ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ 
    // ================================================================= 
    /** ØªÙˆÚ¯Ù„ Ø¯Ø§Ø±Ú© Ù…ÙˆØ¯ **/ 
    const themeToggle = document.getElementById('themeToggle'); 
    themeToggle.addEventListener('click', () => { 
      document.body.classList.toggle('dark'); 
      const isDark = document.body.classList.contains('dark'); 
      localStorage.setItem('theme', isDark ? 'dark' : 'light'); 
      document.querySelector('#themeToggle i').className = isDark ? 'fas fa-sun' : 'fas fa-moon'; 
    }); 
    if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) { 
      document.body.classList.add('dark'); 
      document.querySelector('#themeToggle i').className = 'fas fa-sun'; 
    } else { 
      document.querySelector('#themeToggle i').className = 'fas fa-moon'; 
    } 
    /** Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… */ 
    function displayMessage(message, type = 'success') { 
      const container = document.querySelector('.container'); 
      const alert = document.createElement('div'); 
      let color = ''; 
      if (type === 'success') color = 'bg-green-100 border-green-400 text-green-700'; 
      else if (type === 'error') color = 'bg-red-100 border-red-400 text-red-700'; 
      else color = 'bg-blue-100 border-blue-400 text-blue-700'; 
      alert.className = 'p-4 border ' + color + ' rounded-lg mb-4 text-sm fixed top-0 left-1/2 transform -translate-x-1/2 mt-4 z-50 shadow-xl'; 
      alert.textContent = message; 
      container.prepend(alert); 
      setTimeout(() => alert.remove(), 5000); 
    } 
    /** ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® Unix Timestamp */ 
    function formatTimestamp(timestamp) { 
      if (!timestamp || timestamp === 0) return '---'; 
      const date = new Date(timestamp * 1000); 
      return date.toLocaleDateString('fa-IR') + ' ' + date.toLocaleTimeString('fa-IR'); 
    } 
    /** ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® ISO String */ 
    function formatISO(isoString) { 
      if (!isoString) return '---'; 
      const date = new Date(isoString); 
      return date.toLocaleDateString('fa-IR') + ' ' + date.toLocaleTimeString('fa-IR'); 
    } 
    /** Ø§ÛŒØ¬Ø§Ø¯ Modal */ 
    function createModal(title, contentHTML) { 
      const modalContainer = document.getElementById('modalContainer'); 
      modalContainer.innerHTML = ''; 
      modalContainer.classList.remove('hidden'); 
      const isDark = document.body.classList.contains('dark'); 
      const modalOverlay = document.createElement('div'); 
      modalOverlay.className = 'modal-overlay'; 
      const modalContent = document.createElement('div'); 
      modalContent.className = 'modal-content w-full md:w-3/4 ' + (isDark ? 'modal-dark' : 'bg-white'); 
      modalContent.innerHTML = '<div class="flex justify-between items-center border-b pb-3 mb-4">' + 
        '<h3 class="text-xl font-bold ' + (isDark ? 'text-white' : 'text-gray-900') + '">' + title + '</h3>' + 
        '<button id="closeModal" class="text-gray-600 dark:text-gray-400 hover:text-red-500 transition">' + 
          '<i class="fas fa-times text-xl"></i>' + 
        '</button>' + 
        '</div>' + 
        '<div id="modalBody" class="max-h-96 overflow-y-auto">' + contentHTML + '</div>'; 
      modalContent.querySelector('#closeModal').addEventListener('click', () => { 
        modalContainer.classList.add('hidden'); 
        modalContainer.innerHTML = ''; 
      }); 
      modalOverlay.appendChild(modalContent); 
      modalContainer.appendChild(modalOverlay); 
    } 
    // ================================================================= 
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± 
    // ================================================================= 
    async function loadStats() { 
      try { 
        const response = await fetch(API_BASE + '/stats'); 
        if (!response.ok) { 
          const errorData = await response.json().catch(() => ({ error: 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ Worker' })); 
          displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±: ' + (errorData.error || 'Ù†Ø§Ø´Ù†Ø§Ø³'), 'error'); 
          return; 
        } 
        const data = await response.json(); 
        if (data.success) { 
          const stats = data.stats; 
          document.getElementById('totalUsers').textContent = (stats.total_users || 0).toLocaleString('fa-IR'); 
          document.getElementById('totalActive').textContent = (stats.active_users || 0).toLocaleString('fa-IR'); 
          document.getElementById('newToday').textContent = (stats.new_today || 0).toLocaleString('fa-IR'); 
          document.getElementById('totalCoins').textContent = (stats.total_coins || 0).toLocaleString('fa-IR'); 
          document.getElementById('bannedNow').textContent = (stats.banned_now || 0).toLocaleString('fa-IR'); 
          document.getElementById('totalAdmins').textContent = (stats.total_admins || 0).toLocaleString('fa-IR'); 
        } else { 
          displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±: ' + (data.error || 'Ù†Ø§Ø´Ù†Ø§Ø³'), 'error'); 
        } 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø´Ø¨Ú©Ù‡: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± Ù†Ø§Ù…ÙˆÙÙ‚', 'error'); 
        console.error('Error loading stats:', error); 
      } 
    } 
    // ================================================================= 
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú¯Ù†Ø¬â€ŒÙ‡Ø§ 
    // ================================================================= 
    async function loadTreasureList() { 
      const body = document.getElementById('treasureListBody'); 
      body.innerHTML = '<tr><td colspan="5" class="p-4 text-center"><i class="fas fa-spinner fa-spin ml-2"></i> Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ù†Ø¬â€ŒÙ‡Ø§...</td></tr>'; 
      try { 
        const response = await fetch(API_BASE + '/list_treasures'); 
        if (!response.ok) { 
          body.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-500">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ù†Ø¬â€ŒÙ‡Ø§</td></tr>'; 
          return; 
        } 
        const data = await response.json(); 
        if (data.success) { 
          body.innerHTML = ''; 
          data.treasures.forEach(treasure => { 
            const row = document.createElement('tr'); 
            row.innerHTML = '<td class="px-6 py-4 whitespace-nowrap">' + treasure.id + '</td>' + 
              '<td class="px-6 py-4 whitespace-nowrap">' + treasure.name + '</td>' + 
              '<td class="px-6 py-4 whitespace-nowrap">' + 
                '<input type="number" value="' + treasure.coins_reward + '" class="treasure-coins-input w-24 p-1 border dark:border-gray-600 dark:bg-gray-700 rounded text-right" min="1" />' + 
              '</td>' + 
              '<td class="px-6 py-4 whitespace-nowrap">' + 
                '<input type="number" value="' + (treasure.timer_duration_seconds || 300) + '" class="treasure-duration-input w-24 p-1 border dark:border-gray-600 dark:bg-gray-700 rounded text-right" min="1" />' + 
              '</td>' + 
              '<td class="px-6 py-4 whitespace-nowrap">' + 
                '<button data-id="' + treasure.id + '" class="update-treasure-btn bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">' + 
                  '<i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡' + 
                '</button>' + 
                '<button data-id="' + treasure.id + '" class="delete-treasure-btn bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 ml-2">' + 
                  '<i class="fas fa-trash"></i> Ø­Ø°Ù' + 
                '</button>' + 
              '</td>'; 
            body.appendChild(row); 
          }); 
          document.querySelectorAll('.update-treasure-btn').forEach(btn => { 
            btn.addEventListener('click', async (e) => { 
              const treasure_id = e.target.closest('button').getAttribute('data-id'); 
              const row = e.target.closest('tr'); 
              const coins_input = row.querySelector('.treasure-coins-input'); 
              const duration_input = row.querySelector('.treasure-duration-input'); 
              const coins = parseInt(coins_input.value); 
              const duration = parseInt(duration_input.value); 
              if (isNaN(coins) || coins < 1 || isNaN(duration) || duration < 1) { 
                displayMessage('Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡ Ùˆ Ø²Ù…Ø§Ù† (Ø«Ø§Ù†ÛŒÙ‡) Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'error'); 
                return; 
              } 
              const result = await runAction('/update_treasure', 'POST', { treasure_id: treasure_id, coins_reward: coins, timer_duration_seconds: duration }); 
              if (result.success) { 
                displayMessage('Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡ Ùˆ Ø²Ù…Ø§Ù† Ú¯Ù†Ø¬ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.'); 
              } 
            }); 
          }); 
          document.querySelectorAll('.delete-treasure-btn').forEach(btn => { 
            btn.addEventListener('click', async (e) => { 
              const treasure_id = e.target.closest('button').getAttribute('data-id'); 
              if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú¯Ù†Ø¬ ' + treasure_id + ' Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) return; 
              const result = await runAction('/delete_treasure', 'POST', { treasure_id: treasure_id }); 
              if (result.success) { 
                displayMessage('Ú¯Ù†Ø¬ Ø­Ø°Ù Ø´Ø¯.'); 
                loadTreasureList(); 
              } 
            }); 
          }); 
        } else { 
          body.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-500">Ø®Ø·Ø§: ' + (data.error || 'Ù†Ø§Ù…Ø´Ø®Øµ') + '</td></tr>'; 
        } 
      } catch (error) { 
        body.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-500">Ø®Ø·Ø§ Ø¯Ø± Ø´Ø¨Ú©Ù‡.</td></tr>'; 
        console.error('Error loading treasures:', error); 
      } 
    } 
    // ================================================================= 
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† 
    // ================================================================= 
    async function loadUserList(page = 1) { 
      currentPage = page; 
      const body = document.getElementById('userListBody'); 
      body.innerHTML = '<tr><td colspan="7" class="p-4 text-center"><i class="fas fa-spinner fa-spin ml-2"></i> Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†...</td></tr>'; 
      try { 
        const response = await fetch(API_BASE + '/all_users?page=' + page + '&limit=' + limit); 
        if (!response.ok) { 
          const errorData = await response.json().catch(() => ({ error: 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ Worker' })); 
          body.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-red-500">Ø®Ø·Ø§: ' + response.status + ' - ' + (errorData.error || 'Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±') + '</td></tr>'; 
          displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', 'error'); 
          return; 
        } 
        const data = await response.json(); 
        if (data.success) { 
          const users = data.users; 
          const total = data.total; 
          const totalPages = Math.ceil(total / limit); 
          document.getElementById('userCount').textContent = total.toLocaleString('fa-IR'); 
          document.getElementById('pageInfo').textContent = 'ØµÙØ­Ù‡ ' + page + ' Ø§Ø² ' + totalPages + ' (Ú©Ù„: ' + total + ')'; 
          document.getElementById('prevPageButton').disabled = (page <= 1); 
          document.getElementById('nextPageButton').disabled = (page >= totalPages || totalPages === 0); 
          body.innerHTML = ''; 
          if (users.length === 0) { 
            body.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-gray-500 dark:text-gray-400">Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>'; 
            return; 
          } 
          users.forEach(user => { 
            const activeStatus = user.active ? '<span class="text-green-500">ÙØ¹Ø§Ù„</span>' : '<span class="text-red-500">ØºÛŒØ±ÙØ¹Ø§Ù„</span>'; 
            const adminBadge = user.is_admin ? '<span class="text-xs mr-2 p-1 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">Ø§Ø¯Ù…ÛŒÙ†</span>' : ''; 
            const bannedBadge = user.ban_until > Math.floor(Date.now() / 1000) ? '<span class="text-xs mr-2 p-1 rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">Ø¨Ù†</span>' : ''; 
            const row = document.createElement('tr'); 
            row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition cursor-pointer'; 
            row.innerHTML = '<td class="px-6 py-4 whitespace-nowrap">' + 
              '<span class="font-bold">' + user.name + '</span>' + 
              '<br>' + 
              '<span class="text-xs text-gray-500 dark:text-gray-400 font-mono">' + user.id + '</span>' + 
            '</td>' + 
            '<td class="px-6 py-4 whitespace-nowrap">' + (user.coins || 0).toLocaleString('fa-IR') + '</td>' + 
            '<td class="px-6 py-4 whitespace-nowrap">Ø³Ø·Ø­ ' + user.level + ' (' + user.job + ')</td>' + 
            '<td class="px-6 py-4 whitespace-nowrap text-sm">' + formatTimestamp(user.created_at) + '</td>' + 
            '<td class="px-6 py-4 whitespace-nowrap text-sm">' + formatTimestamp(user.last_login) + '</td>' + 
            '<td class="px-6 py-4 whitespace-nowrap text-sm">' + activeStatus + ' ' + adminBadge + ' ' + bannedBadge + '</td>' + 
            '<td class="px-6 py-4 whitespace-nowrap text-sm">' + 
              '<button data-id="' + user.id + '" class="view-user-btn text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 font-medium">' + 
                '<i class="fas fa-eye"></i> Ù…Ø´Ø§Ù‡Ø¯Ù‡' + 
              '</button>' + 
            '</td>'; 
            body.appendChild(row); 
          }); 
          document.querySelectorAll('.view-user-btn').forEach(button => { 
            button.addEventListener('click', (e) => { 
              const id = e.currentTarget.getAttribute('data-id'); 
              fetchUserDetails(id); 
            }); 
          }); 
        } else { 
          body.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-red-500">Ø®Ø·Ø§: ' + (data.error || 'Ù†Ø§Ù…Ø´Ø®Øµ') + '</td></tr>'; 
          displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', 'error'); 
        } 
      } catch (error) { 
        body.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-red-500">Ø®Ø·Ø§ Ø¯Ø± Ø´Ø¨Ú©Ù‡.</td></tr>'; 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø´Ø¨Ú©Ù‡: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù†Ø§Ù…ÙˆÙÙ‚', 'error'); 
        console.error('Error loading user list:', error); 
      } 
    } 
    document.getElementById('prevPageButton').addEventListener('click', () => { 
      if (currentPage > 1) loadUserList(currentPage - 1); 
    }); 
    document.getElementById('nextPageButton').addEventListener('click', () => { 
      loadUserList(currentPage + 1); 
    }); 
    // ================================================================= 
    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ú©Ø§Ø±Ø¨Ø± 
    // ================================================================= 
    document.getElementById('searchButton').addEventListener('click', async () => { 
      const query = document.getElementById('userSearchInput').value.trim(); 
      if (query.length < 2) { 
        displayMessage('Ø­Ø¯Ø§Ù‚Ù„ 2 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'error'); 
        return; 
      } 
      try { 
        const response = await fetch(API_BASE + '/search_users?query=' + encodeURIComponent(query)); 
        if (!response.ok) { 
          displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ', 'error'); 
          return; 
        } 
        const data = await response.json(); 
        if (data.success) { 
          const users = data.users; 
          const resultsDiv = document.getElementById('searchResults'); 
          const resultsList = document.getElementById('searchResultsList'); 
          if (users.length === 0) { 
            resultsList.innerHTML = '<p class="text-center text-gray-500">Ù‡ÛŒÚ† Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>'; 
            resultsDiv.classList.remove('hidden'); 
            return; 
          } 
          resultsList.innerHTML = ''; 
          users.forEach(user => { 
            const userCard = document.createElement('div'); 
            userCard.className = 'p-3 border dark:border-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition flex justify-between items-center'; 
            const activeStatus = user.active ? '<span class="text-green-500">ÙØ¹Ø§Ù„</span>' : '<span class="text-red-500">ØºÛŒØ±ÙØ¹Ø§Ù„</span>'; 
            const adminBadge = user.is_admin ? '<span class="text-xs mr-2 p-1 rounded-full bg-yellow-100 text-yellow-800">Ø§Ø¯Ù…ÛŒÙ†</span>' : ''; 
            const bannedBadge = user.ban_until > Math.floor(Date.now() / 1000) ? '<span class="text-xs mr-2 p-1 rounded-full bg-red-100 text-red-800">Ø¨Ù†</span>' : ''; 
            userCard.innerHTML = '<div>' + 
              '<p class="font-bold">' + user.name + ' ' + adminBadge + ' ' + bannedBadge + '</p>' + 
              '<p class="text-sm text-gray-600 dark:text-gray-400">ID: ' + user.id + ' | Ø³Ú©Ù‡: ' + user.coins.toLocaleString('fa-IR') + ' | Ø³Ø·Ø­: ' + user.level + '</p>' + 
              '</div>' + 
              '<button class="bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700 text-sm">Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>'; 
            userCard.addEventListener('click', () => { 
              fetchUserDetails(user.id); 
              resultsDiv.classList.add('hidden'); 
            }); 
            resultsList.appendChild(userCard); 
          }); 
          resultsDiv.classList.remove('hidden'); 
        } else { 
          displayMessage('Ø®Ø·Ø§: ' + data.error, 'error'); 
        } 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ', 'error'); 
        console.error('Search error:', error); 
      } 
    }); 
    // ================================================================= 
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø± (Ø¨Ø§ skip_login_update) 
    // ================================================================= 
    async function fetchUserDetails(id) { 
      const detailsDiv = document.getElementById('userDetails'); 
      detailsDiv.classList.remove('hidden'); 
      detailsDiv.scrollIntoView({ behavior: 'smooth' }); 
      try { 
        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² skip_login_update=1 Ø¨Ø±Ø§ÛŒ Ø¹Ø¯Ù… Ø¢Ù¾Ø¯ÛŒØª last_login 
        const response = await fetch(API_BASE + '/user?id=' + id + '&skip_login_update=1'); 
        if (!response.ok) { 
          const errorData = await response.json().catch(() => ({ error: 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ Worker' })); 
          displayMessage('Ø¬Ø³ØªØ¬Ùˆ Ù†Ø§Ù…ÙˆÙÙ‚: ' + (errorData.error || 'Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯'), 'error'); 
          detailsDiv.classList.add('hidden'); 
          return; 
        } 
        const data = await response.json(); 
        if (data.success) { 
          const user = data.user; 
          currentUserData = user; 
          document.getElementById('userName').textContent = user.name; 
          document.getElementById('detailId').textContent = user.id; 
          document.getElementById('detailCreatedAt').textContent = formatTimestamp(user.created_at); 
          document.getElementById('detailLastLogin').textContent = formatTimestamp(user.last_login); 
          document.getElementById('detailReferral').textContent = user.referral_code; 
          const activeEl = document.getElementById('detailActive'); 
          activeEl.textContent = user.active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'; 
          activeEl.className = user.active ? 'text-green-600 font-bold mr-1' : 'text-red-600 font-bold mr-1'; 
          const adminEl = document.getElementById('detailAdmin'); 
          adminEl.textContent = user.is_admin ? 'Ø§Ø¯Ù…ÛŒÙ†' : ''; 
          adminEl.classList.toggle('hidden', !user.is_admin); 
          const banEl = document.getElementById('detailBan'); 
          const now = Math.floor(Date.now() / 1000); 
          if (user.ban_until > now) { 
            const remainingMinutes = Math.ceil((user.ban_until - now) / 60); 
            banEl.textContent = 'ØªØ§ ' + user.ban_date + ' (Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒ: ' + remainingMinutes + ' Ø¯Ù‚ÛŒÙ‚Ù‡)'; 
            banEl.classList.add('text-red-500'); 
          } else { 
            banEl.textContent = 'Ø¨Ù† Ù†ÛŒØ³Øª'; 
            banEl.classList.remove('text-red-500'); 
          } 
          document.getElementById('currentName').textContent = user.name; 
          document.getElementById('editName').value = user.name; 
          document.getElementById('currentCoins').textContent = (user.coins || 0).toLocaleString('fa-IR'); 
          document.getElementById('editCoins').value = user.coins; 
          document.getElementById('currentJob').textContent = user.job; 
          document.getElementById('editJob').value = user.job; 
          document.getElementById('currentLevel').textContent = (user.level || 1).toLocaleString('fa-IR'); 
          document.getElementById('editLevel').value = user.level; 
          document.getElementById('currentExp').textContent = (user.experience || 0).toLocaleString('fa-IR'); 
          document.getElementById('editExp').value = user.experience; 
          document.getElementById('toggleAdminButton').textContent = user.is_admin ? 'Ø­Ø°Ù ÙˆØ¶Ø¹ÛŒØª Ø§Ø¯Ù…ÛŒÙ†' : 'Ø§Ø¹Ø·Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§Ø¯Ù…ÛŒÙ†'; 
          document.getElementById('toggleAdminButton').setAttribute('data-admin', user.is_admin ? '1' : '0'); 
          document.getElementById('toggleActiveButton').textContent = user.active ? 'ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†' : 'ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†'; 
          document.getElementById('toggleActiveButton').setAttribute('data-active', user.active ? '1' : '0'); 
        } else { 
          detailsDiv.classList.add('hidden'); 
          displayMessage('Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯: ' + id, 'error'); 
        } 
      } catch (error) { 
        detailsDiv.classList.add('hidden'); 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±', 'error'); 
        console.error('Error fetching user details:', error); 
      } 
    } 
    // ================================================================= 
    // ØªÙˆØ§Ø¨Ø¹ Modal 
    // ================================================================= 
    /** Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª */ 
    document.getElementById('viewChatHistoryButton').addEventListener('click', () => { 
      if (!currentUserData) { 
        displayMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯.', 'error'); 
        return; 
      } 
      let chatHTML = ''; 
      const messages = currentUserData.message_history || []; 
      if (messages.length === 0) { 
        chatHTML = '<p class="text-center text-gray-500 dark:text-gray-400">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù¾ÛŒØ§Ù…ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>'; 
      } else { 
        chatHTML = '<ul class="space-y-3">'; 
        messages.slice().reverse().forEach(msg => { 
          chatHTML += '<li class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 shadow-sm">' + 
            '<p class="text-sm font-mono text-gray-600 dark:text-gray-300">' + formatISO(msg.timestamp) + '</p>' + 
            '<p class="mt-1">' + msg.message + '</p>' + 
            '</li>'; 
        }); 
        chatHTML += '</ul>'; 
      } 
      createModal('ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª: ' + currentUserData.name, chatHTML); 
    }); 
    /** Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§ */ 
    document.getElementById('viewNameHistoryButton').addEventListener('click', () => { 
      if (!currentUserData) { 
        displayMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯.', 'error'); 
        return; 
      } 
      let historyHTML = ''; 
      const names = currentUserData.name_history || []; 
      if (names.length <= 1) { 
        historyHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ù‡Ø±Ú¯Ø² Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ØªØºÛŒÛŒØ± Ù†Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª.</p>'; 
      } else { 
        historyHTML = '<ul class="space-y-3">'; 
        names.slice().reverse().forEach(item => { 
          historyHTML += '<li class="p-3 rounded-lg bg-gray-100 dark:bg-gray-700 shadow-sm flex justify-between items-center">' + 
            '<span class="font-bold">' + item.name + '</span>' + 
            '<span class="text-sm font-mono text-gray-600 dark:text-gray-300">' + formatISO(item.timestamp) + '</span>' + 
            '</li>'; 
        }); 
        historyHTML += '</ul>'; 
      } 
      createModal('ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§: ' + currentUserData.name, historyHTML); 
    }); 
    // ================================================================= 
    // ØªÙˆØ§Ø¨Ø¹ Modal Ø¢Ù…Ø§Ø± (Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§) 
    // ================================================================= 
    // Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ù¾ÙˆÙ„Ø¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ 
    document.getElementById('cardTotalCoins').addEventListener('click', async () => { 
      try { 
        const response = await fetch(API_BASE + '/top_coins?limit=10'); 
        const data = await response.json(); 
        if (data.success) { 
          let listHTML = '<ul class="space-y-2">'; 
          data.top_users.forEach((user, index) => { 
            listHTML += '<li class="flex justify-between p-2 rounded-lg bg-indigo-50 dark:bg-gray-700">' + 
              '<span>' + (index + 1) + '. ' + user.name + ' (' + user.id + ')</span>' + 
              '<span class="font-bold text-indigo-700 dark:text-indigo-300">' + user.coins.toLocaleString('fa-IR') + ' Ø³Ú©Ù‡</span>' + 
              '</li>'; 
          }); 
          listHTML += '</ul>'; 
          createModal('ğŸ”Ÿ Ù¾ÙˆÙ„Ø¯Ø§Ø±ØªØ±ÛŒÙ† Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', listHTML); 
        } 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø±ØªØ±', 'error'); 
      } 
    }); 
    // Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù† Ø´Ø¯Ù‡ ÙØ¹Ø§Ù„ 
    document.getElementById('cardBannedNow').addEventListener('click', async () => { 
      try { 
        const response = await fetch(API_BASE + '/banned_users'); 
        const data = await response.json(); 
        if (data.success) { 
          let listHTML = '<ul class="space-y-2">'; 
          data.banned_users.forEach(user => { 
            listHTML += '<li class="p-2 rounded-lg bg-red-50 dark:bg-red-900 border border-red-300">' + 
              '<span class="font-bold">' + user.name + ' (' + user.id + ')</span>' + 
              '<br>' + 
              '<span class="text-sm text-gray-600 dark:text-gray-300">Ø¨Ù† ØªØ§: ' + formatTimestamp(user.ban_until) + '</span>' + 
              '</li>'; 
          }); 
          if (data.banned_users.length === 0) { 
            listHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Ú©Ø§Ø±Ø¨Ø± Ø¨Ù† Ø´Ø¯Ù‡ ÙØ¹Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>'; 
          } else { 
            listHTML += '</ul>'; 
          } 
          createModal('ğŸ”¨ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù† Ø´Ø¯Ù‡ ÙØ¹Ø§Ù„', listHTML); 
        } 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù† Ø´Ø¯Ù‡', 'error'); 
      } 
    }); 
    // Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø§Ù…Ø±ÙˆØ² 
    document.getElementById('cardNewToday').addEventListener('click', async () => { 
      try { 
        const response = await fetch(API_BASE + '/top_new?limit=20'); 
        const data = await response.json(); 
        if (data.success) { 
          let listHTML = '<ul class="space-y-2">'; 
          data.new_users.forEach(user => { 
            listHTML += '<li class="flex justify-between p-2 rounded-lg bg-yellow-50 dark:bg-yellow-900">' + 
              '<span class="font-bold">' + user.name + ' (' + user.id + ')</span>' + 
              '<span class="text-sm font-mono text-gray-600 dark:text-gray-300">' + formatTimestamp(user.created_at) + '</span>' + 
              '</li>'; 
          }); 
          if (data.new_users.length === 0) { 
            listHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>'; 
          } else { 
            listHTML += '</ul>'; 
          } 
          createModal('ğŸ†• Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', listHTML); 
        } 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯', 'error'); 
      } 
    }); 
    // Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ (Ø¬Ø¯ÛŒØ¯) 
    document.getElementById('cardTotalAdmins').addEventListener('click', async () => { 
      try { 
        const response = await fetch(API_BASE + '/list_admins?limit=50'); 
        const data = await response.json(); 
        if (data.success) { 
          let listHTML = '<ul class="space-y-2">'; 
          data.admins.forEach((user, index) => { 
            listHTML += '<li class="p-2 rounded-lg bg-purple-50 dark:bg-purple-900 border border-purple-300 flex justify-between">' + 
              '<div>' + 
                '<span class="font-bold">' + (index + 1) + '. ' + user.name + '</span>' + 
                '<br>' + 
                '<span class="text-xs font-mono text-gray-600 dark:text-gray-300">' + user.id + '</span>' + 
              '</div>' + 
              '<div class="text-right">' + 
                '<span class="text-sm">Ø³Ú©Ù‡: ' + user.coins.toLocaleString('fa-IR') + '</span><br>' + 
                '<span class="text-xs">Ø³Ø·Ø­: ' + user.level + '</span>' + 
              '</div>' + 
              '</li>'; 
          }); 
          if (data.admins.length === 0) { 
            listHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Ù‡ÛŒÚ† Ø§Ø¯Ù…ÛŒÙ†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>'; 
          } else { 
            listHTML += '</ul>'; 
          } 
          createModal('ğŸ‘‘ Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§', listHTML); 
        } 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§', 'error'); 
      } 
    }); 
    // Ø¯Ú©Ù…Ù‡ Ù†Ù…Ø§ÛŒØ´ Ú†Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± (Ø¬Ø¯ÛŒØ¯) 
    document.getElementById('btnShowRecentChats').addEventListener('click', async () => { 
      try { 
        const response = await fetch(API_BASE + '/recent_chats?limit=50'); 
        const data = await response.json(); 
        if (data.success) { 
          let listHTML = '<ul class="space-y-3">'; 
          data.recent_chats.forEach(chat => { 
            listHTML += '<li class="p-3 rounded-lg bg-blue-50 dark:bg-blue-900 border border-blue-300">' + 
              '<p class="font-bold text-sm">' + chat.user_name + ' <span class="text-xs font-mono text-gray-500">(' + chat.user_id + ')</span></p>' + 
              '<p class="text-xs text-gray-600 dark:text-gray-400 mb-1">' + formatISO(chat.timestamp) + '</p>' + 
              '<p class="text-sm">' + chat.message + '</p>' + 
              '</li>'; 
          }); 
          if (data.recent_chats.length === 0) { 
            listHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Ù‡ÛŒÚ† Ù¾ÛŒØ§Ù…ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>'; 
          } else { 
            listHTML += '</ul>'; 
          } 
          createModal('ğŸ’¬ Ú†Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± (50 ØªØ§ÛŒ Ø¢Ø®Ø±)', listHTML); 
        } 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú†Øªâ€ŒÙ‡Ø§', 'error'); 
      } 
    }); 
    // Ø¯Ú©Ù…Ù‡ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù† Ø´Ø¯Ù‡ (Ø¬Ø¯ÛŒØ¯) 
    document.getElementById('btnShowListBanned').addEventListener('click', async () => { 
      try { 
        const response = await fetch(API_BASE + '/banned_users'); 
        const data = await response.json(); 
        if (data.success) { 
          let listHTML = '<ul class="space-y-2">'; 
          data.banned_users.forEach(user => { 
            listHTML += '<li class="p-3 rounded-lg bg-red-50 dark:bg-red-900 border border-red-300">' + 
              '<p class="font-bold">' + user.name + ' <span class="text-xs font-mono">(' + user.id + ')</span></p>' + 
              '<p class="text-sm text-gray-600 dark:text-gray-300">Ø¨Ù† ØªØ§: ' + formatTimestamp(user.ban_until) + '</p>' + 
              '</li>'; 
          }); 
          if (data.banned_users.length === 0) { 
            listHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Ú©Ø§Ø±Ø¨Ø± Ø¨Ù† Ø´Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>'; 
          } else { 
            listHTML += '</ul>'; 
          } 
          createModal('ğŸ”’ Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù† Ø´Ø¯Ù‡', listHTML); 
        } 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù† Ø´Ø¯Ù‡', 'error'); 
      } 
    }); 
    // Ø¯Ú©Ù…Ù‡ Ø¨Ù† Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ (Ø¬Ø¯ÛŒØ¯) 
    document.getElementById('btnShowBulkBan').addEventListener('click', async () => { 
      try { 
        const response = await fetch(API_BASE + '/all_users?page=1&limit=100'); 
        if (!response.ok) { 
          displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', 'error'); 
          return; 
        } 
        const data = await response.json(); 
        if (!data.success) { 
          displayMessage('Ø®Ø·Ø§: ' + data.error, 'error'); 
          return; 
        } 
        let modalHTML = '<div class="mb-4">' + 
          '<label class="block font-bold mb-2">Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¨Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡):</label>' + 
          '<input id="bulkBanMinutes" type="number" placeholder="Ù…Ø«Ø§Ù„: 60" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded" />' + 
          '</div>'; 
        modalHTML += '<div class="mb-4 max-h-96 overflow-y-auto border dark:border-gray-700 rounded p-2">'; 
        modalHTML += '<p class="font-bold mb-2">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø­Ø¯Ø§Ú©Ø«Ø± 20 Ù†ÙØ±):</p>'; 
        data.users.forEach(user => { 
          const activeStatus = user.active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'; 
          const adminBadge = user.is_admin ? ' [Ø§Ø¯Ù…ÛŒÙ†]' : ''; 
          modalHTML += '<div class="flex items-center mb-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">' + 
            '<input type="checkbox" class="bulk-ban-checkbox ml-2" value="' + user.id + '" />' + 
            '<label class="flex-grow cursor-pointer">' + 
              '<span class="font-bold">' + user.name + adminBadge + '</span>' + 
              '<span class="text-xs text-gray-600 dark:text-gray-400"> (ID: ' + user.id + ', Ø³Ú©Ù‡: ' + user.coins + ', ' + activeStatus + ')</span>' + 
            '</label>' + 
            '</div>'; 
        }); 
        modalHTML += '</div>'; 
        modalHTML += '<button id="bulkBanExecute" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 w-full mt-2">' + 
          '<i class="fas fa-hammer ml-2"></i> Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù† Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ' + 
          '</button>'; 
        createModal('ğŸš« Ø¨Ù† Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ (Ø­Ø¯Ø§Ú©Ø«Ø± 20 Ú©Ø§Ø±Ø¨Ø±)', modalHTML); 
        // Event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù† 
        document.getElementById('bulkBanExecute').addEventListener('click', async () => { 
          const minutes = parseInt(document.getElementById('bulkBanMinutes').value); 
          if (!minutes || minutes <= 0) { 
            displayMessage('Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¨Ù† Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'error'); 
            return; 
          } 
          const checkboxes = document.querySelectorAll('.bulk-ban-checkbox:checked'); 
          if (checkboxes.length === 0) { 
            displayMessage('Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'error'); 
            return; 
          } 
          if (checkboxes.length > 20) { 
            displayMessage('Ø­Ø¯Ø§Ú©Ø«Ø± 20 Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'error'); 
            return; 
          } 
          const user_ids = Array.from(checkboxes).map(cb => cb.value); 
          if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ' + user_ids.length + ' Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¨Ø±Ø§ÛŒ ' + minutes + ' Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ù† Ú©Ù†ÛŒØ¯ØŸ')) return; 
          const result = await runAction('/bulk_ban', 'POST', { user_ids: user_ids, duration_minutes: minutes }); 
          if (result.success) { 
            displayMessage(result.data.message); 
            document.getElementById('modalContainer').classList.add('hidden'); 
            loadStats(); 
            loadUserList(currentPage); 
          } 
        }); 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', 'error'); 
        console.error(error); 
      } 
    }); 
    // ================================================================= 
    // ØªÙˆØ§Ø¨Ø¹ Ø§Ú©Ø´Ù† (Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø¯ÛŒØ±ÛŒØªÛŒ) 
    // ================================================================= 
    /** Ø§Ø¬Ø±Ø§ÛŒ fetch Ø¨Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ */ 
    async function runAction(endpoint, method = 'GET', body = null) { 
      const options = { method: method, headers: { 'Content-Type': 'application/json' }, }; 
      if (body) options.body = JSON.stringify(body); 
      try { 
        const response = await fetch(API_BASE + endpoint, options); 
        if (!response.ok) { 
          const errorData = await response.json().catch(() => ({ error: 'Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ± Ù†Ø§Ù…Ø´Ø®Øµ (' + response.status + ')' })); 
          displayMessage('Ø¹Ù…Ù„ÛŒØ§Øª Ù†Ø§Ù…ÙˆÙÙ‚: ' + errorData.error, 'error'); 
          return { success: false, error: errorData.error }; 
        } 
        const data = await response.json(); 
        if (data.success || data.id) { 
          return { success: true, data: data }; 
        } else { 
          displayMessage('Ø¹Ù…Ù„ÛŒØ§Øª Ù†Ø§Ù…ÙˆÙÙ‚: ' + (data.error || 'Ø®Ø·Ø§ÛŒ API'), 'error'); 
          return { success: false, error: data.error }; 
        } 
      } catch (error) { 
        displayMessage('Ø®Ø·Ø§ Ø¯Ø± Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø§ØªØµØ§Ù„ Ø¨Ù‡ API', 'error'); 
        console.error('Action error:', error); 
        return { success: false, error: 'Network Error' }; 
      } 
    } 
    /** Ø¹Ù…Ù„ÛŒØ§Øª Ø¢Ù¾Ø¯ÛŒØª Ø§ØµÙ„ÛŒ (Ù†Ø§Ù…, Ø³Ú©Ù‡â€ŒÙ‡Ø§, Ø´ØºÙ„) */ 
    document.getElementById('updateInfoButton').addEventListener('click', async () => { 
      const id = document.getElementById('detailId').textContent; 
      const coins = document.getElementById('editCoins').value; 
      const job = document.getElementById('editJob').value; 
      const name = document.getElementById('editName').value; 
      const body = { id: id, coins: parseInt(coins), job: job, name: name }; 
      const result = await runAction('/update', 'POST', body); 
      if (result.success) { 
        displayMessage('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.'); 
        fetchUserDetails(id); 
        loadStats(); 
        loadUserList(currentPage); 
      } 
    }); 
    /** Ø¹Ù…Ù„ÛŒØ§Øª Ø¢Ù¾Ø¯ÛŒØª Ø³Ø·Ø­ Ùˆ ØªØ¬Ø±Ø¨Ù‡ */ 
    document.getElementById('updateLevelExpButton').addEventListener('click', async () => { 
      const id = document.getElementById('detailId').textContent; 
      const level = document.getElementById('editLevel').value; 
      const experience = document.getElementById('editExp').value; 
      const body = { id: id, level: parseInt(level), experience: parseInt(experience) }; 
      const result = await runAction('/update', 'POST', body); 
      if (result.success) { 
        displayMessage('Ø³Ø·Ø­ Ùˆ ØªØ¬Ø±Ø¨Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.'); 
        fetchUserDetails(id); 
      } 
    }); 
    /** Ø¹Ù…Ù„ÛŒØ§Øª Ø¨Ù† */ 
    document.getElementById('banButton').addEventListener('click', async () => { 
      const id = document.getElementById('detailId').textContent; 
      const minutes = parseInt(document.getElementById('banMinutes').value); 
      if (!minutes || minutes <= 0) { 
        displayMessage('Ù„Ø·ÙØ§Ù‹ Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¨Ù† Ù…Ø¹ØªØ¨Ø± (Ø¯Ù‚ÛŒÙ‚Ù‡) Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'error'); 
        return; 
      } 
      if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± ' + id + ' Ø±Ø§ Ø¨Ø±Ø§ÛŒ ' + minutes + ' Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ù† Ú©Ù†ÛŒØ¯ØŸ')) return; 
      const result = await runAction('/ban', 'POST', { id: id, duration_minutes: minutes }); 
      if (result.success) { 
        displayMessage('Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±Ø§ÛŒ ' + minutes + ' Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ù† Ø´Ø¯.'); 
        fetchUserDetails(id); 
        loadStats(); 
        loadUserList(currentPage); 
      } 
    }); 
    /** Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø°Ù Ø¨Ù† */ 
    document.getElementById('unbanButton').addEventListener('click', async () => { 
      const id = document.getElementById('detailId').textContent; 
      if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù† Ú©Ø§Ø±Ø¨Ø± ' + id + ' Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) return; 
      const result = await runAction('/ban', 'POST', { id: id, duration_minutes: 0 }); 
      if (result.success) { 
        displayMessage('Ø¨Ù† Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.'); 
        fetchUserDetails(id); 
        loadStats(); 
        loadUserList(currentPage); 
      } 
    }); 
    /** Ø¹Ù…Ù„ÛŒØ§Øª ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø§Ø¯Ù…ÛŒÙ† */ 
    document.getElementById('toggleAdminButton').addEventListener('click', async (e) => { 
      const id = document.getElementById('detailId').textContent; 
      const currentAdminStatus = e.currentTarget.getAttribute('data-admin') === '1'; 
      const newAdminStatus = !currentAdminStatus; 
      if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÙˆØ¶Ø¹ÛŒØª Ø§Ø¯Ù…ÛŒÙ† Ø¨ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± ' + id + ' Ø±Ø§ Ø¨Ù‡ ' + (newAdminStatus ? 'Ø§Ø¯Ù…ÛŒÙ†' : 'Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ') + ' ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ØŸ')) return; 
      const result = await runAction('/update', 'POST', { id: id, is_admin: newAdminStatus }); 
      if (result.success) { 
        displayMessage('ÙˆØ¶Ø¹ÛŒØª Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ ' + (newAdminStatus ? 'Ø§Ø¯Ù…ÛŒÙ†' : 'Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ') + ' ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.'); 
        fetchUserDetails(id); 
        loadStats(); 
      } 
    }); 
    /** Ø¹Ù…Ù„ÛŒØ§Øª ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø± */ 
    document.getElementById('toggleActiveButton').addEventListener('click', async (e) => { 
      const id = document.getElementById('detailId').textContent; 
      const currentActiveStatus = e.currentTarget.getAttribute('data-active') === '1'; 
      const newActiveStatus = !currentActiveStatus; 
      if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± ' + id + ' Ø±Ø§ Ø¨Ù‡ ' + (newActiveStatus ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„') + ' ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ØŸ')) return; 
      const result = await runAction('/update', 'POST', { id: id, active: newActiveStatus }); 
      if (result.success) { 
        displayMessage('ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ ' + (newActiveStatus ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„') + ' ØªØºÛŒÛŒØ± ÛŒØ§ÙØª.'); 
        fetchUserDetails(id); 
        loadUserList(currentPage); 
        loadStats(); 
      } 
    }); 
    /** Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø± */ 
    document.getElementById('deleteButton').addEventListener('click', async () => { 
      const id = document.getElementById('detailId').textContent; 
      if (!confirm('Ù‡Ø´Ø¯Ø§Ø±: Ø¢ÛŒØ§ ÙˆØ§Ù‚Ø¹Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± ' + id + ' Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.')) return; 
      const result = await runAction('/delete', 'POST', { id: id }); 
      if (result.success) { 
        displayMessage('Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.'); 
        document.getElementById('userDetails').classList.add('hidden'); 
        loadUserList(1); 
        loadStats(); 
      } 
    }); 
    // Ø§ÙØ²ÙˆØ¯Ù† Ú¯Ù†Ø¬ Ø¬Ø¯ÛŒØ¯ 
    document.getElementById('addTreasureBtn').addEventListener('click', async () => { 
      const name = document.getElementById('newTreasureName').value.trim(); 
      const coins = parseInt(document.getElementById('newTreasureCoins').value); 
      const duration = parseInt(document.getElementById('newTreasureDuration').value); 
      if (!name || isNaN(coins) || coins < 1 || isNaN(duration) || duration < 1) { 
        displayMessage('Ù†Ø§Ù…, Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡ Ùˆ Ø²Ù…Ø§Ù† (Ø«Ø§Ù†ÛŒÙ‡) Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'error'); 
        return; 
      } 
      const result = await runAction('/add_treasure', 'POST', { name: name, coins_reward: coins, timer_duration_seconds: duration }); 
      if (result.success) { 
        displayMessage('Ú¯Ù†Ø¬ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.'); 
        document.getElementById('newTreasureName').value = ''; 
        document.getElementById('newTreasureCoins').value = ''; 
        document.getElementById('newTreasureDuration').value = ''; 
        loadTreasureList(); 
      } 
    }); 
    // ================================================================= 
    // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ 
    // ================================================================= 
    loadStats(); 
    loadUserList(1); 
    loadTreasureList(); 
  </script> 
</body> 
</html> 
