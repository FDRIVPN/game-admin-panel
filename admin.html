<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§Ø²ÛŒ</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root {
      --primary: #6366f1;
      --danger: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
      --dark: #1f2937;
      --light: #f9fafb;
    }
    
    /* Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª */
    .auth-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.95);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(10px);
    }
    
    .auth-box {
      background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      padding: 3rem;
      border-radius: 1.5rem;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
      width: 90%;
      max-width: 450px;
      border: 1px solid #374151;
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª */
    .compact-mode .user-card {
      padding: 0.75rem;
      font-size: 0.875rem;
    }
    
    .compact-mode .user-card .details {
      display: none;
    }
    
    .expanded-mode .user-card {
      padding: 1.5rem;
      font-size: 1rem;
    }
    
    .expanded-mode .user-card .details {
      display: block;
    }
    
    /* Ú©Ø§Ø±Øª Ú©Ø§Ø±Ø¨Ø± */
    .user-card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      border: 1px solid #e5e7eb;
    }
    
    .dark .user-card {
      background: #1f2937;
      border-color: #374151;
    }
    
    .user-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
    }
    
    /* Ù†Ø´Ø§Ù†Ú¯Ø± gem */
    .gem-badge {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.875rem;
    }
    
    /* Ù…ÙˆØ¯Ø§Ù„ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.75);
      z-index: 999;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-content {
      background: #fff;
      padding: 2rem;
      border-radius: 1.5rem;
      max-width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .dark .modal-content {
      background: #1f2937;
      color: #e5e7eb;
    }
    
    /* Ø§Ø³Ú©Ø±ÙˆÙ„Ø¨Ø§Ø± Ø²ÛŒØ¨Ø§ */
    ::-webkit-scrollbar {
      width: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f3f4f6;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #9ca3af;
      border-radius: 10px;
    }
    
    .dark ::-webkit-scrollbar-track {
      background: #374151;
    }
    
    .dark ::-webkit-scrollbar-thumb {
      background: #6b7280;
    }
    
    /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ù† Ù‚Ø±Ù…Ø² */
    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
      color: white !important;
      border: none !important;
    }
    
    .btn-danger:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
      transform: translateY(-2px);
    }
    
    /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± */
    .stat-card {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      cursor: pointer;
      border: 1px solid #e5e7eb;
    }
    
    .dark .stat-card {
      background: #1f2937;
      border-color: #374151;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2);
    }
    
    /* Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª */
    .progress-bar {
      height: 0.5rem;
      background: #e5e7eb;
      border-radius: 9999px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6);
      border-radius: 9999px;
      transition: width 0.5s ease;
    }
    
    /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      width: 2rem;
      height: 2rem;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Ø§Ø¹Ù„Ø§Ù† */
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
      max-width: 400px;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .notification.success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border-left: 4px solid #34d399;
    }
    
    .notification.error {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      border-left: 4px solid #f87171;
    }
    
    .notification.warning {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      border-left: 4px solid #fbbf24;
    }
    
    /* Ø¯Ú©Ù…Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ */
    .select-button {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }
    
    .select-button.selected {
      background: #3b82f6;
      color: white;
      font-weight: bold;
    }
    
    /* Ø¯Ø±Ø§Ù¾â€ŒØ¯Ø§Ù† */
    .dropdown {
      position: relative;
      display: inline-block;
    }
    
    .dropdown-content {
      display: none;
      position: absolute;
      background: white;
      min-width: 200px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      z-index: 1;
      border-radius: 0.5rem;
      overflow: hidden;
    }
    
    .dark .dropdown-content {
      background: #1f2937;
      border: 1px solid #374151;
    }
    
    .dropdown:hover .dropdown-content {
      display: block;
    }
    
    /* ØªÚ¯â€ŒÙ‡Ø§ */
    .tag {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.25rem;
    }
    
    .tag.admin {
      background: rgba(168, 85, 247, 0.1);
      color: #a855f7;
    }
    
    .tag.banned {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }
    
    .tag.active {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
    }
    
    /* Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù */
    .view-mode-grid .users-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    
    .view-mode-list .users-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    /* Ù¾ÙˆÛŒØ§Ù†Ù…Ø§ÛŒÛŒâ€ŒÙ‡Ø§ */
    .pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .shake {
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen transition-colors duration-300">
  
  <!-- ØµÙØ­Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª -->
  <div id="authOverlay" class="auth-overlay">
    <div class="auth-box">
      <div class="text-center mb-8">
        <div class="inline-block p-4 rounded-2xl bg-gradient-to-br from-blue-600 to-purple-600 mb-4">
          <i class="fas fa-user-shield text-4xl text-white"></i>
        </div>
        <h2 class="text-3xl font-bold text-white">ğŸ” ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
        <p class="text-gray-400 mt-2">Ù„Ø·ÙØ§Ù‹ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø¯Ù…ÛŒÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-gray-300 mb-2 text-sm font-medium">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø¯Ù…ÛŒÙ†</label>
          <input id="adminPassword" type="password" 
                 placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø¯Ù…ÛŒÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"
                 class="w-full p-3 rounded-xl bg-gray-800 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                 onkeypress="if(event.key === 'Enter') authenticate()">
        </div>
        
        <button onclick="authenticate()" 
                class="w-full bg-gradient-to-r from-blue-600 to-blue-800 text-white p-3 rounded-xl hover:opacity-90 transition-all duration-300 font-semibold text-lg shadow-lg hover:shadow-xl">
          <i class="fas fa-sign-in-alt ml-2"></i> ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª
        </button>
        
        <p id="authError" class="text-red-400 text-center mt-4 hidden animate-pulse">
          <i class="fas fa-exclamation-circle ml-1"></i> Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª
        </p>
        
        <div class="text-center mt-6 pt-6 border-t border-gray-800">
          <p class="text-gray-500 text-sm">
            <i class="fas fa-info-circle ml-1"></i>
            Ø§ÛŒÙ† Ù¾Ù†Ù„ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±Ø§Ù† Ø³ÛŒØ³ØªÙ… Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø³Øª
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ Ù¾Ù†Ù„ -->
  <div id="mainPanel" class="hidden">
    <!-- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ÛŒÛŒ -->
    <div class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-50">
      <div class="container mx-auto px-4 py-3">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-4 space-x-reverse">
            <div class="bg-gradient-to-br from-blue-600 to-purple-600 p-2 rounded-xl">
              <i class="fas fa-gamepad text-2xl text-white"></i>
            </div>
            <div>
              <h1 class="text-xl font-bold">ğŸ® Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§Ø²ÛŒ</h1>
              <p class="text-sm text-gray-500 dark:text-gray-400">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ØŒ Ø§Ø±Ø²ØŒ Ø¨Ù†â€ŒÙ‡Ø§ Ùˆ Ú¯Ù†Ø¬â€ŒÙ‡Ø§</p>
            </div>
          </div>
          
          <div class="flex items-center space-x-3 space-x-reverse">
            <button id="themeToggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition" title="ØªØºÛŒÛŒØ± ØªÙ…">
              <i class="fas fa-moon"></i>
            </button>
            
            <button onclick="showUserProfile()" class="p-2 rounded-lg bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300" title="Ù¾Ø±ÙˆÙØ§ÛŒÙ„">
              <i class="fas fa-user"></i>
            </button>
            
            <button onclick="logout()" class="p-2 rounded-lg bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300" title="Ø®Ø±ÙˆØ¬">
              <i class="fas fa-sign-out-alt"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
    <div class="container mx-auto px-4 py-6 max-w-7xl">
      <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <div class="stat-card" onclick="showAllUsers()">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400">ğŸ‘¥ Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</p>
              <p id="totalUsers" class="text-3xl font-bold mt-1">0</p>
              <p class="text-xs text-gray-500 mt-1"><span id="activeUsers">0</span> Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ø§Ù„</p>
            </div>
            <i class="fas fa-users text-3xl text-blue-400 opacity-80"></i>
          </div>
          <div class="mt-4">
            <div class="progress-bar">
              <div id="activeUsersProgress" class="progress-fill" style="width: 0%"></div>
            </div>
          </div>
        </div>
        
        <div class="stat-card" onclick="showTopCoins()">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400">ğŸ’° Ú©Ù„ Ø«Ø±ÙˆØª</p>
              <p id="totalCoins" class="text-3xl font-bold mt-1">0</p>
              <p id="totalGems" class="text-sm text-amber-600 dark:text-amber-400 font-semibold mt-1">0 Ø¬Ù…</p>
            </div>
            <i class="fas fa-coins text-3xl text-yellow-400 opacity-80"></i>
          </div>
          <div class="mt-4 flex items-center text-sm text-gray-500">
            <i class="fas fa-exchange-alt ml-1"></i>
            <span>Ù†Ø±Ø®: 1000 Ø³Ú©Ù‡ = 1 Ø¬Ù…</span>
          </div>
        </div>
        
        <div class="stat-card" onclick="showBannedUsers()">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400">ğŸ”¨ ÙˆØ¶Ø¹ÛŒØª Ø¨Ù†</p>
              <p id="bannedNow" class="text-3xl font-bold mt-1">0</p>
              <p class="text-xs text-gray-500 mt-1">Ú©Ø§Ø±Ø¨Ø± Ø¨Ù† Ø´Ø¯Ù‡</p>
            </div>
            <i class="fas fa-ban text-3xl text-red-400 opacity-80"></i>
          </div>
          <div class="mt-4">
            <button onclick="showBanHistory()" class="text-xs bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 px-3 py-1 rounded-lg">
              <i class="fas fa-history ml-1"></i> Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡
            </button>
          </div>
        </div>
        
        <div class="stat-card" onclick="showAdminList()">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-sm text-gray-500 dark:text-gray-400">ğŸ‘‘ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§</p>
              <p id="totalAdmins" class="text-3xl font-bold mt-1">0</p>
              <p class="text-xs text-gray-500 mt-1">Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</p>
            </div>
            <i class="fas fa-user-shield text-3xl text-purple-400 opacity-80"></i>
          </div>
          <div class="mt-4">
            <button onclick="showAdminList()" class="text-xs bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 px-3 py-1 rounded-lg">
              <i class="fas fa-list ml-1"></i> Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
            </button>
          </div>
        </div>
      </div>

      <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹ -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <button onclick="showConvertCurrencyModal()" 
                class="bg-gradient-to-r from-purple-600 to-purple-800 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2">
          <i class="fas fa-exchange-alt text-xl"></i>
          <span>ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²</span>
        </button>
        
        <button onclick="showJobSearchModal()" 
                class="bg-gradient-to-r from-green-600 to-green-800 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2">
          <i class="fas fa-briefcase text-xl"></i>
          <span>Ø¬Ø³ØªØ¬ÙˆÛŒ Ø´ØºÙ„</span>
        </button>
        
        <button onclick="showDataTransferModal()" 
                class="bg-gradient-to-r from-indigo-600 to-indigo-800 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2">
          <i class="fas fa-people-arrows text-xl"></i>
          <span>Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡</span>
        </button>
        
        <button onclick="showAdvancedBulkBan()" 
                class="btn-danger p-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2">
          <i class="fas fa-users-slash text-xl"></i>
          <span>Ø¨Ù† Ù¾ÛŒØ´Ø±ÙØªÙ‡</span>
        </button>
      </div>

      <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 mb-6">
        <div class="flex flex-wrap gap-4 items-center justify-between">
          <div class="flex items-center gap-3">
            <span class="font-medium">Ù†Ù…Ø§ÛŒØ´:</span>
            <div class="flex gap-1 bg-gray-100 dark:bg-gray-700 p-1 rounded-lg">
              <button onclick="setViewMode('compact')" id="btnCompact" class="select-button">
                <i class="fas fa-compress ml-1"></i> ÙØ´Ø±Ø¯Ù‡
              </button>
              <button onclick="setViewMode('expanded')" id="btnExpanded" class="select-button selected">
                <i class="fas fa-expand ml-1"></i> Ú¯Ø³ØªØ±Ø¯Ù‡
              </button>
            </div>
            
            <div class="flex gap-1 bg-gray-100 dark:bg-gray-700 p-1 rounded-lg">
              <button onclick="setListView('grid')" id="btnGrid" class="select-button">
                <i class="fas fa-th-large ml-1"></i> Ø´Ø¨Ú©Ù‡â€ŒØ§ÛŒ
              </button>
              <button onclick="setListView('list')" id="btnList" class="select-button selected">
                <i class="fas fa-list ml-1"></i> Ù„ÛŒØ³ØªÛŒ
              </button>
            </div>
          </div>
          
          <div class="flex items-center gap-3">
            <span class="font-medium">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø± ØµÙØ­Ù‡:</span>
            <select id="pageSizeSelect" onchange="changePageSize(this.value)" 
                    class="bg-gray-100 dark:bg-gray-700 border-0 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
              <option value="10">10 Ú©Ø§Ø±Ø¨Ø±</option>
              <option value="20">20 Ú©Ø§Ø±Ø¨Ø±</option>
              <option value="50" selected>50 Ú©Ø§Ø±Ø¨Ø±</option>
              <option value="100">100 Ú©Ø§Ø±Ø¨Ø±</option>
              <option value="all">Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</option>
            </select>
          </div>
        </div>
        
        <div class="mt-4 flex flex-wrap gap-4">
          <!-- Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø±ÛŒØ¹ -->
          <div class="flex-1 min-w-[300px]">
            <div class="relative">
              <input id="quickSearch" type="text" 
                     placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø± (Ù†Ø§Ù…ØŒ Ø´Ù†Ø§Ø³Ù‡ØŒ Ø´ØºÙ„)"
                     class="w-full p-3 pr-10 rounded-lg bg-gray-100 dark:bg-gray-700 border-0 focus:ring-2 focus:ring-blue-500">
              <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
          </div>
          
          <!-- ÙÛŒÙ„ØªØ±Ù‡Ø§ -->
          <div class="flex gap-2">
            <button onclick="filterUsers('active')" class="px-4 py-2 rounded-lg bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300">
              ÙØ¹Ø§Ù„â€ŒÙ‡Ø§
            </button>
            <button onclick="filterUsers('banned')" class="px-4 py-2 rounded-lg bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300">
              Ø¨Ù†â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§
            </button>
            <button onclick="filterUsers('admin')" class="px-4 py-2 rounded-lg bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300">
              Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
            </button>
            <button onclick="clearFilters()" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700">
              Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
            </button>
          </div>
        </div>
      </div>

      <!-- Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
      <div id="usersContainer" class="view-mode-list">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold flex items-center gap-2">
            <i class="fas fa-users"></i>
            Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
            <span id="usersCount" class="text-sm font-normal bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 px-3 py-1 rounded-full">0</span>
          </h2>
          
          <div class="flex items-center gap-2">
            <button onclick="refreshUsers()" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">
              <i class="fas fa-sync-alt"></i>
            </button>
            <button onclick="exportUsers()" class="p-2 rounded-lg bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300">
              <i class="fas fa-download"></i>
            </button>
          </div>
        </div>
        
        <!-- Ù‡Ø¯Ø± Ø¬Ø¯ÙˆÙ„ (Ø¯Ø± Ø­Ø§Ù„Øª Ù„ÛŒØ³ØªÛŒ) -->
        <div id="tableHeader" class="hidden md:grid grid-cols-12 gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-t-xl border-b dark:border-gray-700 font-semibold text-sm">
          <div class="col-span-3">Ú©Ø§Ø±Ø¨Ø±</div>
          <div class="col-span-2">Ø§Ø±Ø²</div>
          <div class="col-span-2">Ø³Ø·Ø­/Ø´ØºÙ„</div>
          <div class="col-span-2">ÙˆØ¶Ø¹ÛŒØª</div>
          <div class="col-span-3">Ø¹Ù…Ù„ÛŒØ§Øª</div>
        </div>
        
        <!-- Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
        <div id="usersList" class="space-y-3 mb-6">
          <div class="text-center py-12 text-gray-500">
            <div class="loading-spinner mx-auto"></div>
            <p class="mt-4">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†...</p>
          </div>
        </div>
        
        <!-- Pagination -->
        <div class="flex justify-between items-center mt-8">
          <div id="pageInfo" class="text-sm text-gray-600 dark:text-gray-400">
            Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...
          </div>
          
          <div class="flex gap-2">
            <button id="firstPage" onclick="goToPage(1)" 
                    class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-angle-double-right"></i>
            </button>
            <button id="prevPage" onclick="prevPage()" 
                    class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-chevron-right"></i>
            </button>
            
            <div class="flex gap-1">
              <!-- ØµÙØ­Ø§Øª Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ JS Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
            
            <button id="nextPage" onclick="nextPage()" 
                    class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button id="lastPage" onclick="goToPage(100)" 
                    class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
              <i class="fas fa-angle-double-left"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Ø¨Ø®Ø´ Ú¯Ù†Ø¬â€ŒÙ‡Ø§ -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 mt-8">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold flex items-center gap-2">
            <i class="fas fa-gem text-purple-500"></i>
            Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ù†Ø¬â€ŒÙ‡Ø§
          </h2>
          <button onclick="showAddTreasureModal()" 
                  class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded-lg hover:opacity-90">
            <i class="fas fa-plus ml-2"></i> Ø§ÙØ²ÙˆØ¯Ù† Ú¯Ù†Ø¬ Ø¬Ø¯ÛŒØ¯
          </button>
        </div>
        
        <div id="treasuresList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Ú¯Ù†Ø¬â€ŒÙ‡Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
      </div>

      <!-- Ø¢Ù…Ø§Ø± Ù¾ÛŒØ´Ø±ÙØªÙ‡ -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
        <!-- Ø¢Ù…Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡ -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
          <h3 class="text-lg font-bold mb-4">ğŸ“Š Ø¢Ù…Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
          <div class="space-y-4">
            <div>
              <div class="flex justify-between mb-1">
                <span class="text-sm">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø§Ù…Ø±ÙˆØ²</span>
                <span id="newToday" class="font-bold">0</span>
              </div>
              <div class="progress-bar">
                <div id="newUsersProgress" class="progress-fill" style="width: 0%"></div>
              </div>
            </div>
            
            <div>
              <div class="flex justify-between mb-1">
                <span class="text-sm">Ú†Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²</span>
                <span id="chatsToday" class="font-bold">0</span>
              </div>
              <div class="progress-bar">
                <div id="chatsProgress" class="progress-fill" style="width: 0%"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ØªÙˆØ²ÛŒØ¹ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6">
          <h3 class="text-lg font-bold mb-4">ğŸ“ˆ ØªÙˆØ²ÛŒØ¹ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span>Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³Ø·Ø­ Û±-Û±Û°</span>
              <span id="usersLevel1_10" class="font-bold">0</span>
            </div>
            <div class="flex justify-between">
              <span>Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³Ø·Ø­ Û±Û±-Û²Û°</span>
              <span id="usersLevel11_20" class="font-bold">0</span>
            </div>
            <div class="flex justify-between">
              <span>Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³Ø·Ø­ Û²Û±+</span>
              <span id="usersLevel21+" class="font-bold">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-12 py-6 border-t dark:border-gray-800 bg-white dark:bg-gray-900">
      <div class="container mx-auto px-4 text-center text-gray-600 dark:text-gray-400">
        <p>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§Ø²ÛŒ â€¢ Ù†Ø³Ø®Ù‡ Û².Û° â€¢ ØªÙˆØ³Ø¹Ù‡ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸</p>
        <p class="text-sm mt-2">Â© Û²Û°Û²Û´ - ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª</p>
      </div>
    </footer>
  </div>

  <!-- Container Ø¨Ø±Ø§ÛŒ Modal Ù‡Ø§ -->
  <div id="modalContainer" class="hidden"></div>

  <!-- Container Ø¨Ø±Ø§ÛŒ Notifications -->
  <div id="notificationContainer"></div>

  <script>
    // =================================================================
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
    // =================================================================
    const API_BASE = window.location.origin;
    let currentPage = 1;
    let currentPageSize = 50;
    let totalUsers = 0;
    let totalPages = 1;
    let adminToken = null;
    let currentFilter = null;
    let currentSearch = '';
    let currentViewMode = 'expanded';
    let currentListView = 'list';
    let usersData = [];

    // =================================================================
    // ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
    // =================================================================

    // Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
    async function authenticate() {
      const password = document.getElementById('adminPassword').value;
      if (!password) {
        showNotification('Ù„Ø·ÙØ§Ù‹ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
        document.getElementById('authError').classList.remove('hidden');
        return;
      }

      try {
        const response = await fetch(API_BASE + '/admin_auth', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });

        if (response.ok) {
          const data = await response.json();
          adminToken = data.token;
          document.getElementById('authOverlay').style.display = 'none';
          document.getElementById('mainPanel').classList.remove('hidden');
          loadStats();
          loadUsers();
          loadTreasures();
          showNotification('Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯.', 'success');
        } else {
          showNotification('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª', 'error');
          document.getElementById('authError').classList.remove('hidden');
          document.getElementById('adminPassword').classList.add('shake');
          setTimeout(() => {
            document.getElementById('adminPassword').classList.remove('shake');
          }, 500);
        }
      } catch (error) {
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
      }
    }

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±
    async function loadStats() {
      try {
        const response = await fetch(API_BASE + '/stats');
        const data = await response.json();
        
        if (data.success) {
          const stats = data.stats;
          
          // Ø¢Ù¾Ø¯ÛŒØª Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø±
          document.getElementById('totalUsers').textContent = formatNumber(stats.total_users);
          document.getElementById('totalCoins').textContent = formatNumber(stats.total_coins);
          document.getElementById('totalGems').textContent = formatNumber(stats.total_gems || 0);
          document.getElementById('bannedNow').textContent = formatNumber(stats.banned_now);
          document.getElementById('totalAdmins').textContent = formatNumber(stats.total_admins);
          document.getElementById('activeUsers').textContent = formatNumber(stats.active_users);
          document.getElementById('newToday').textContent = formatNumber(stats.new_today || 0);
          
          // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø±ØµØ¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„
          const activePercent = stats.total_users > 0 ? (stats.active_users / stats.total_users) * 100 : 0;
          document.getElementById('activeUsersProgress').style.width = `${activePercent}%`;
          
          // Ø¢Ù¾Ø¯ÛŒØª Ø¯ÛŒÚ¯Ø± Ø¢Ù…Ø§Ø±
          document.getElementById('chatsToday').textContent = '0'; // Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø² API Ø¯ÛŒÚ¯Ø± Ú¯Ø±ÙØªÙ‡ Ø´ÙˆØ¯
          
          // ØªÙˆØ²ÛŒØ¹ Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ù†Ù…ÙˆÙ†Ù‡)
          document.getElementById('usersLevel1_10').textContent = formatNumber(Math.floor(stats.total_users * 0.6));
          document.getElementById('usersLevel11_20').textContent = formatNumber(Math.floor(stats.total_users * 0.3));
          document.getElementById('usersLevel21+').textContent = formatNumber(Math.floor(stats.total_users * 0.1));
        }
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
    async function loadUsers() {
      const usersList = document.getElementById('usersList');
      usersList.innerHTML = `
        <div class="text-center py-12 text-gray-500">
          <div class="loading-spinner mx-auto"></div>
          <p class="mt-4">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†...</p>
        </div>
      `;

      try {
        let url;
        if (currentPageSize === 'all') {
          url = `${API_BASE}/get_all_users_for_bulk`;
        } else {
          url = `${API_BASE}/all_users?page=${currentPage}&limit=${currentPageSize}`;
        }
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success) {
          usersData = data.users;
          totalUsers = data.total || data.users.length;
          totalPages = Math.ceil(totalUsers / currentPageSize);
          
          updateUsersDisplay();
          updatePagination();
        } else {
          showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†', 'error');
        }
      } catch (error) {
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±', 'error');
        console.error('Error loading users:', error);
      }
    }

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
    function updateUsersDisplay() {
      const usersList = document.getElementById('usersList');
      const usersCount = document.getElementById('usersCount');
      
      usersCount.textContent = formatNumber(usersData.length);
      
      if (usersData.length === 0) {
        usersList.innerHTML = `
          <div class="text-center py-16 text-gray-500">
            <i class="fas fa-users-slash text-5xl mb-4"></i>
            <p class="text-lg">Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
          </div>
        `;
        return;
      }

      let html = '';
      const now = Math.floor(Date.now() / 1000);

      usersData.forEach(user => {
        const isBanned = user.ban_until > now;
        const isAdmin = user.is_admin;
        const isActive = user.active;
        
        // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¬Ø³ØªØ¬Ùˆ
        if (currentSearch && !user.name.toLowerCase().includes(currentSearch.toLowerCase()) && 
            !user.id.toLowerCase().includes(currentSearch.toLowerCase()) &&
            !user.job.toLowerCase().includes(currentSearch.toLowerCase())) {
          return;
        }
        
        // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
        if (currentFilter === 'banned' && !isBanned) return;
        if (currentFilter === 'active' && !isActive) return;
        if (currentFilter === 'admin' && !isAdmin) return;

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø¨Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡
        let banTimeRemaining = '';
        if (isBanned) {
          const remaining = user.ban_until - now;
          const hours = Math.floor(remaining / 3600);
          const minutes = Math.floor((remaining % 3600) / 60);
          banTimeRemaining = `${hours} Ø³Ø§Ø¹Øª Ùˆ ${minutes} Ø¯Ù‚ÛŒÙ‚Ù‡`;
        }

        // Ø³Ø§Ø®Øª Ú©Ø§Ø±Øª Ú©Ø§Ø±Ø¨Ø±
        html += `
          <div class="user-card ${currentViewMode === 'compact' ? 'compact-mode' : 'expanded-mode'}">
            <div class="flex justify-between items-start">
              <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± -->
              <div class="flex-1">
                <div class="flex items-center gap-3">
                  <div class="relative">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold">
                      ${user.name.charAt(0)}
                    </div>
                    ${isAdmin ? '<span class="tag admin absolute -top-1 -right-1">ğŸ‘‘</span>' : ''}
                    ${isBanned ? '<span class="tag banned absolute -bottom-1 -right-1">ğŸ”¨</span>' : ''}
                  </div>
                  
                  <div>
                    <h3 class="font-bold text-lg">${user.name}</h3>
                    <p class="text-sm text-gray-500 font-mono">${user.id}</p>
                    <div class="flex gap-2 mt-1">
                      ${isActive ? '<span class="tag active">ÙØ¹Ø§Ù„</span>' : '<span class="tag banned">ØºÛŒØ±ÙØ¹Ø§Ù„</span>'}
                      ${isAdmin ? '<span class="tag admin">Ø§Ø¯Ù…ÛŒÙ†</span>' : ''}
                      ${isBanned ? '<span class="tag banned">Ø¨Ù† Ø´Ø¯Ù‡</span>' : ''}
                    </div>
                  </div>
                </div>
                
                <!-- Ø¬Ø²Ø¦ÛŒØ§Øª (Ø¯Ø± Ø­Ø§Ù„Øª expanded) -->
                <div class="details mt-4">
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <p class="text-sm text-gray-500">Ø³Ø·Ø­/Ø´ØºÙ„</p>
                      <p class="font-semibold">Ø³Ø·Ø­ ${user.level} â€¢ ${user.job}</p>
                    </div>
                    <div>
                      <p class="text-sm text-gray-500">ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</p>
                      <p class="font-semibold">${formatDate(user.created_at)}</p>
                    </div>
                    <div>
                      <p class="text-sm text-gray-500">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯</p>
                      <p class="font-semibold">${formatDate(user.last_login)}</p>
                    </div>
                    <div>
                      <p class="text-sm text-gray-500">Ú©Ø¯ Ø¯Ø¹ÙˆØª</p>
                      <p class="font-semibold font-mono">${user.referral_code || '-'}</p>
                    </div>
                  </div>
                  
                  ${isBanned ? `
                    <div class="mt-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                      <p class="text-sm text-red-600 dark:text-red-400 font-semibold">
                        <i class="fas fa-ban ml-1"></i> Ú©Ø§Ø±Ø¨Ø± Ø¨Ù† Ø´Ø¯Ù‡ Ø§Ø³Øª
                      </p>
                      <p class="text-xs text-red-500 dark:text-red-300 mt-1">
                        Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${banTimeRemaining}
                      </p>
                    </div>
                  ` : ''}
                </div>
              </div>
              
              <!-- Ø§Ø±Ø² Ùˆ Ø¹Ù…Ù„ÛŒØ§Øª -->
              <div class="text-right">
                <!-- Ø§Ø±Ø² -->
                <div class="mb-4">
                  <div class="flex items-center justify-end gap-2 mb-1">
                    <span class="text-yellow-600 dark:text-yellow-400 font-bold text-xl">
                      ${formatNumber(user.coins)}
                    </span>
                    <i class="fas fa-coins text-yellow-500"></i>
                  </div>
                  <div class="flex items-center justify-end gap-2">
                    <span class="gem-badge">
                      <i class="fas fa-gem"></i>
                      ${user.gem || 0}
                    </span>
                  </div>
                </div>
                
                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª -->
                <div class="flex flex-wrap gap-2 justify-end">
                  <button onclick="viewUserDetails('${user.id}')" 
                          class="px-3 py-2 rounded-lg bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-800 transition">
                    <i class="fas fa-eye ml-1"></i>
                    <span class="hidden md:inline">Ù…Ø´Ø§Ù‡Ø¯Ù‡</span>
                  </button>
                  
                  <button onclick="showBanModal('${user.id}', '${user.name}')" 
                          class="px-3 py-2 rounded-lg bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800 transition">
                    <i class="fas fa-ban ml-1"></i>
                    <span class="hidden md:inline">Ø¨Ù†</span>
                  </button>
                  
                  <div class="dropdown">
                    <button class="px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <div class="dropdown-content mt-1 rounded-lg shadow-lg">
                      <button onclick="editUser('${user.id}')" 
                              class="w-full text-right px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <i class="fas fa-edit ml-2"></i> ÙˆÛŒØ±Ø§ÛŒØ´
                      </button>
                      <button onclick="toggleAdminStatus('${user.id}', ${isAdmin})" 
                              class="w-full text-right px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <i class="fas fa-user-shield ml-2"></i> ${isAdmin ? 'Ø­Ø°Ù Ø§Ø¯Ù…ÛŒÙ†' : 'Ø§Ø¹Ø·Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†'}
                      </button>
                      <button onclick="deleteUser('${user.id}', '${user.name}')" 
                              class="w-full text-right px-4 py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition">
                        <i class="fas fa-trash ml-2"></i> Ø­Ø°Ù
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      });

      usersList.innerHTML = html;
    }

    // =================================================================
    // ØªÙˆØ§Ø¨Ø¹ Modal
    // =================================================================

    // Modal ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²
    function showConvertCurrencyModal() {
      const modalHTML = `
        <div class="modal-overlay" onclick="closeModal(event)">
          <div class="modal-content max-w-md" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold">ğŸ’° ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²</h3>
              <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>
            
            <div class="space-y-4">
              <div>
                <label class="block mb-2 font-medium">Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±</label>
                <input id="convertUserId" type="text" 
                       placeholder="Ù…Ø«Ø§Ù„: abc123def456"
                       class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block mb-2 font-medium">Ø§Ø²</label>
                  <select id="convertFrom" class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700">
                    <option value="coins">Ø³Ú©Ù‡</option>
                    <option value="gem">Ø¬Ù…</option>
                  </select>
                </div>
                <div>
                  <label class="block mb-2 font-medium">Ø¨Ù‡</label>
                  <select id="convertTo" class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700">
                    <option value="gem">Ø¬Ù…</option>
                    <option value="coins">Ø³Ú©Ù‡</option>
                  </select>
                </div>
              </div>
              
              <div>
                <label class="block mb-2 font-medium">Ù…Ù‚Ø¯Ø§Ø±</label>
                <input id="convertAmount" type="number" min="1" 
                       placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"
                       class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500">
                
                <div class="mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                  <p class="text-sm text-blue-600 dark:text-blue-400 font-semibold">
                    <i class="fas fa-info-circle ml-1"></i> Ù†Ø±Ø® ØªØ¨Ø¯ÛŒÙ„
                  </p>
                  <p class="text-sm text-blue-500 dark:text-blue-300 mt-1">
                    Ù‡Ø± 1000 Ø³Ú©Ù‡ = 1 Ø¬Ù…
                  </p>
                  <p class="text-sm text-blue-500 dark:text-blue-300">
                    Ù‡Ø± 1 Ø¬Ù… = 800 Ø³Ú©Ù‡
                  </p>
                </div>
              </div>
              
              <div class="flex gap-3 pt-4">
                <button onclick="performConvert()" 
                        class="flex-1 bg-gradient-to-r from-green-600 to-green-700 text-white p-3 rounded-lg hover:opacity-90 font-semibold">
                  <i class="fas fa-exchange-alt ml-2"></i> ØªØ¨Ø¯ÛŒÙ„
                </button>
                <button onclick="closeModal()" 
                        class="flex-1 bg-gray-600 text-white p-3 rounded-lg hover:bg-gray-700 font-semibold">
                  Ø§Ù†ØµØ±Ø§Ù
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('modalContainer').innerHTML = modalHTML;
      document.getElementById('modalContainer').classList.remove('hidden');
    }

    // Ø§Ø¬Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²
    async function performConvert() {
      const userId = document.getElementById('convertUserId').value;
      const from = document.getElementById('convertFrom').value;
      const to = document.getElementById('convertTo').value;
      const amount = parseInt(document.getElementById('convertAmount').value);
      
      if (!userId || !amount || amount < 1) {
        showNotification('Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù¾Ø± Ú©Ù†ÛŒØ¯', 'error');
        return;
      }
      
      try {
        const response = await fetch(API_BASE + '/convert_currency', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_id: userId, from, to, amount })
        });
        
        if (response.ok) {
          const data = await response.json();
          showNotification('ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'success');
          closeModal();
          loadStats();
        } else {
          const error = await response.json();
          showNotification(error.error || 'Ø®Ø·Ø§ Ø¯Ø± ØªØ¨Ø¯ÛŒÙ„', 'error');
        }
      } catch (error) {
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
      }
    }

    // Modal Ø¬Ø³ØªØ¬ÙˆÛŒ Ø´ØºÙ„
    function showJobSearchModal() {
      const modalHTML = `
        <div class="modal-overlay" onclick="closeModal(event)">
          <div class="modal-content max-w-2xl" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold">ğŸ‘” Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´ØºÙ„</h3>
              <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>
            
            <div class="mb-6">
              <input id="jobSearchInput" type="text" 
                     placeholder="Ù†Ø§Ù… Ø´ØºÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ø§Ù„: Ú©Ø´Ø§ÙˆØ±Ø²ØŒ Ù…Ø¹Ø¯Ù†Ú†ÛŒØŒ Ø¬Ù†Ú¯Ø¬Ùˆ)"
                     class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700 focus:ring-2 focus:ring-green-500"
                     oninput="searchByJob(this.value)">
            </div>
            
            <div id="jobResults" class="max-h-96 overflow-y-auto">
              <div class="text-center py-12 text-gray-500">
                <i class="fas fa-search text-4xl mb-4"></i>
                <p>Ù„Ø·ÙØ§Ù‹ Ø´ØºÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('modalContainer').innerHTML = modalHTML;
      document.getElementById('modalContainer').classList.remove('hidden');
    }

    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´ØºÙ„
    async function searchByJob(job) {
      if (job.length < 2) {
        document.getElementById('jobResults').innerHTML = `
          <div class="text-center py-12 text-gray-500">
            <p>Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ Û² Ø­Ø±Ù ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
          </div>
        `;
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE}/search_by_job?job=${encodeURIComponent(job)}`);
        const data = await response.json();
        
        const resultsDiv = document.getElementById('jobResults');
        if (data.success && data.users.length > 0) {
          let html = '<div class="space-y-3">';
          data.users.forEach(user => {
            html += `
              <div class="p-4 rounded-lg border dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition cursor-pointer" 
                   onclick="viewUserDetails('${user.id}'); closeModal()">
                <div class="flex justify-between items-center">
                  <div>
                    <h4 class="font-bold">${user.name}</h4>
                    <p class="text-sm text-gray-500">${user.job} â€¢ Ø³Ø·Ø­ ${user.level}</p>
                  </div>
                  <div class="text-right">
                    <div class="flex items-center gap-2">
                      <span class="text-yellow-600">${formatNumber(user.coins)}</span>
                      <i class="fas fa-coins text-yellow-500"></i>
                    </div>
                    <div class="mt-1">
                      <span class="gem-badge text-xs">${user.gem || 0}</span>
                    </div>
                  </div>
                </div>
              </div>
            `;
          });
          html += '</div>';
          resultsDiv.innerHTML = html;
        } else {
          resultsDiv.innerHTML = `
            <div class="text-center py-12 text-gray-500">
              <i class="fas fa-user-slash text-4xl mb-4"></i>
              <p>Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø´ØºÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error searching by job:', error);
      }
    }

    // Modal Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡
    function showDataTransferModal() {
      const modalHTML = `
        <div class="modal-overlay" onclick="closeModal(event)">
          <div class="modal-content max-w-md" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold">ğŸ”„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡ Ú©Ø§Ø±Ø¨Ø±</h3>
              <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>
            
            <div class="space-y-6">
              <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
                <div class="flex gap-3">
                  <i class="fas fa-exclamation-triangle text-yellow-500 text-xl"></i>
                  <div>
                    <p class="font-bold text-yellow-700 dark:text-yellow-400">Ù‡Ø´Ø¯Ø§Ø±!</p>
                    <p class="text-sm text-yellow-600 dark:text-yellow-300 mt-1">
                      ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù…Ù‚ØµØ¯ Ø¨Ø§ Ú©Ø§Ø±Ø¨Ø± Ù…Ø¨Ø¯Ø£ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆØ¯.
                      Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª!
                    </p>
                  </div>
                </div>
              </div>
              
              <div class="space-y-4">
                <div>
                  <label class="block mb-2 font-medium">Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…Ø¨Ø¯Ø£</label>
                  <input id="transferFrom" type="text" 
                         placeholder="Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒØ´ Ù…Ù†ØªÙ‚Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯"
                         class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700">
                </div>
                
                <div>
                  <label class="block mb-2 font-medium">Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…Ù‚ØµØ¯</label>
                  <input id="transferTo" type="text" 
                         placeholder="Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯"
                         class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700">
                </div>
              </div>
              
              <div class="flex gap-3 pt-4">
                <button onclick="performTransfer()" 
                        class="flex-1 bg-gradient-to-r from-red-600 to-red-700 text-white p-3 rounded-lg hover:opacity-90 font-semibold">
                  <i class="fas fa-people-arrows ml-2"></i> Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡
                </button>
                <button onclick="closeModal()" 
                        class="flex-1 bg-gray-600 text-white p-3 rounded-lg hover:bg-gray-700 font-semibold">
                  Ø§Ù†ØµØ±Ø§Ù
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('modalContainer').innerHTML = modalHTML;
    }

    // Ø§Ø¬Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡
    async function performTransfer() {
      const fromId = document.getElementById('transferFrom').value;
      const toId = document.getElementById('transferTo').value;
      
      if (!fromId || !toId) {
        showNotification('Ù„Ø·ÙØ§Ù‹ Ù‡Ø± Ø¯Ùˆ Ø´Ù†Ø§Ø³Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
        return;
      }
      
      if (fromId === toId) {
        showNotification('Ø´Ù†Ø§Ø³Ù‡ Ù…Ø¨Ø¯Ø£ Ùˆ Ù…Ù‚ØµØ¯ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯', 'error');
        return;
      }
      
      if (!confirm(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± ${fromId} Ø±Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± ${toId} Ù…Ù†ØªÙ‚Ù„ Ú©Ù†ÛŒØ¯ØŸ\nØ§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª!`)) {
        return;
      }
      
      try {
        const response = await fetch(API_BASE + '/transfer_user_data', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ from_user_id: fromId, to_user_id: toId })
        });
        
        if (response.ok) {
          const data = await response.json();
          showNotification('Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'success');
          closeModal();
          loadUsers();
        } else {
          const error = await response.json();
          showNotification(error.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡', 'error');
        }
      } catch (error) {
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
      }
    }

    // Modal Ø¨Ù† Ù¾ÛŒØ´Ø±ÙØªÙ‡
    function showAdvancedBulkBan() {
      const modalHTML = `
        <div class="modal-overlay" onclick="closeModal(event)">
          <div class="modal-content max-w-4xl" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold">ğŸ”¨ Ø¨Ù† Ù¾ÛŒØ´Ø±ÙØªÙ‡ (Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ)</h3>
              <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
              <div>
                <label class="block mb-2 font-medium">Ù…Ø¯Øª Ø²Ù…Ø§Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                <input id="bulkBanMinutes" type="number" min="1" 
                       value="60" class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700">
              </div>
              
              <div>
                <label class="block mb-2 font-medium">Ø´Ù†Ø§Ø³Ù‡ Ø¨Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡</label>
                <input id="bannedById" type="text" 
                       placeholder="Ø´Ù†Ø§Ø³Ù‡ Ø§Ø¯Ù…ÛŒÙ†"
                       class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700">
              </div>
              
              <div class="flex items-end">
                <button onclick="selectAllUsersForBan()" 
                        class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700">
                  <i class="fas fa-check-double ml-2"></i> Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡
                </button>
              </div>
            </div>
            
            <div class="mb-6">
              <div class="flex justify-between items-center mb-3">
                <span class="font-medium">Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</span>
                <span id="selectedCount" class="text-sm text-gray-500">0 Ú©Ø§Ø±Ø¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡</span>
              </div>
              
              <div class="max-h-96 overflow-y-auto border rounded-lg p-2">
                <div id="bulkBanList" class="space-y-2">
                  <!-- Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
              </div>
            </div>
            
            <div class="flex justify-between items-center pt-4 border-t">
              <div id="bulkBanSummary" class="text-sm text-gray-600">
                Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù†...
              </div>
              
              <div class="flex gap-3">
                <button onclick="performAdvancedBulkBan()" 
                        class="btn-danger px-6 py-3 rounded-lg font-semibold">
                  <i class="fas fa-hammer ml-2"></i> Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù† Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ
                </button>
                <button onclick="closeModal()" 
                        class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 font-semibold">
                  Ø§Ù†ØµØ±Ø§Ù
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('modalContainer').innerHTML = modalHTML;
      document.getElementById('modalContainer').classList.remove('hidden');
      
      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø¨Ù†
      loadBulkBanList();
    }

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø¨Ù†
    async function loadBulkBanList() {
      try {
        const response = await fetch(API_BASE + '/get_all_users_for_bulk');
        const data = await response.json();
        
        if (data.success) {
          let html = '';
          data.users.slice(0, 100).forEach(user => { // Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ù‡ Û±Û°Û° Ú©Ø§Ø±Ø¨Ø±
            const isBanned = user.ban_until > Math.floor(Date.now() / 1000);
            
            html += `
              <div class="flex items-center p-3 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg">
                <input type="checkbox" 
                       class="bulk-ban-checkbox h-5 w-5 ml-3"
                       value="${user.id}"
                       ${isBanned ? 'disabled' : ''}>
                
                <div class="flex-1">
                  <div class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">${user.name}</span>
                      <span class="text-xs text-gray-500 font-mono mr-2">(${user.id})</span>
                    </div>
                    <div class="flex items-center gap-3">
                      <span class="text-yellow-600">${formatNumber(user.coins)}</span>
                      ${user.gem ? `<span class="gem-badge text-xs">${user.gem}</span>` : ''}
                      ${isBanned ? '<span class="tag banned text-xs">Ø¨Ù† Ø´Ø¯Ù‡</span>' : ''}
                    </div>
                  </div>
                  <p class="text-sm text-gray-500 mt-1">${user.job} â€¢ Ø³Ø·Ø­ ${user.level}</p>
                </div>
              </div>
            `;
          });
          
          document.getElementById('bulkBanList').innerHTML = html;
          updateBulkBanSelection();
          
          // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ù‡ checkbox Ù‡Ø§
          document.querySelectorAll('.bulk-ban-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', updateBulkBanSelection);
          });
        }
      } catch (error) {
        console.error('Error loading bulk ban list:', error);
      }
    }

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ù†
    function updateBulkBanSelection() {
      const checkboxes = document.querySelectorAll('.bulk-ban-checkbox:checked:not(:disabled)');
      const selectedCount = checkboxes.length;
      
      document.getElementById('selectedCount').textContent = `${selectedCount} Ú©Ø§Ø±Ø¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡`;
      
      const minutes = parseInt(document.getElementById('bulkBanMinutes').value) || 60;
      const bannedBy = document.getElementById('bannedById').value || 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…';
      
      document.getElementById('bulkBanSummary').innerHTML = `
        ${selectedCount} Ú©Ø§Ø±Ø¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ â€¢
        Ù…Ø¯Øª Ø¨Ù†: ${minutes} Ø¯Ù‚ÛŒÙ‚Ù‡ â€¢
        Ø¨Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡: ${bannedBy}
      `;
    }

    // Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø¨Ù†
    function selectAllUsersForBan() {
      document.querySelectorAll('.bulk-ban-checkbox:not(:disabled)').forEach(checkbox => {
        checkbox.checked = true;
      });
      updateBulkBanSelection();
    }

    // Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ù† Ù¾ÛŒØ´Ø±ÙØªÙ‡
    async function performAdvancedBulkBan() {
      const minutes = parseInt(document.getElementById('bulkBanMinutes').value);
      const bannedBy = document.getElementById('bannedById').value;
      
      if (!minutes || minutes < 1) {
        showNotification('Ù„Ø·ÙØ§Ù‹ Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¨Ù† Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
        return;
      }
      
      if (!bannedBy) {
        showNotification('Ù„Ø·ÙØ§Ù‹ Ø´Ù†Ø§Ø³Ù‡ Ø¨Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
        return;
      }
      
      const checkboxes = document.querySelectorAll('.bulk-ban-checkbox:checked:not(:disabled)');
      if (checkboxes.length === 0) {
        showNotification('Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
        return;
      }
      
      const user_ids = Array.from(checkboxes).map(cb => cb.value);
      
      if (!confirm(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ${user_ids.length} Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¨Ø±Ø§ÛŒ ${minutes} Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ù† Ú©Ù†ÛŒØ¯ØŸ`)) {
        return;
      }
      
      try {
        const response = await fetch(API_BASE + '/advanced_bulk_ban', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            user_ids, 
            duration_minutes: minutes, 
            banned_by: bannedBy 
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          showNotification(data.message, 'success');
          closeModal();
          loadStats();
          loadUsers();
        } else {
          const error = await response.json();
          showNotification(error.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù† Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ', 'error');
        }
      } catch (error) {
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
      }
    }

    // Modal Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø±
    async function viewUserDetails(userId) {
      try {
        const response = await fetch(`${API_BASE}/user?id=${userId}&skip_login_update=1`);
        const data = await response.json();
        
        if (data.success) {
          const user = data.user;
          const now = Math.floor(Date.now() / 1000);
          const isBanned = user.ban_until > now;
          
          let banInfo = '';
          if (isBanned) {
            const remaining = user.ban_until - now;
            const hours = Math.floor(remaining / 3600);
            const minutes = Math.floor((remaining % 3600) / 60);
            banInfo = `
              <div class="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg">
                <p class="font-bold text-red-600 dark:text-red-400">
                  <i class="fas fa-ban ml-1"></i> Ú©Ø§Ø±Ø¨Ø± Ø¨Ù† Ø´Ø¯Ù‡ Ø§Ø³Øª
                </p>
                <p class="text-sm text-red-500 dark:text-red-300 mt-1">
                  Ø¨Ù† ØªØ§: ${user.ban_date}
                </p>
                <p class="text-sm text-red-500 dark:text-red-300">
                  Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${hours} Ø³Ø§Ø¹Øª Ùˆ ${minutes} Ø¯Ù‚ÛŒÙ‚Ù‡
                </p>
              </div>
            `;
          }
          
          // Ú¯Ø±ÙØªÙ† ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ù†
          let banHistory = '';
          try {
            const historyResponse = await fetch(`${API_BASE}/get_ban_history?user_id=${userId}`);
            const historyData = await historyResponse.json();
            
            if (historyData.success && historyData.history.length > 0) {
              banHistory = `
                <div class="mt-6">
                  <h4 class="font-bold mb-3">ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ù†</h4>
                  <div class="space-y-2 max-h-48 overflow-y-auto">
                    ${historyData.history.map(ban => `
                      <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                        <div class="flex justify-between items-center">
                          <span class="text-sm font-medium">Ø¨Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡: ${ban.banned_by}</span>
                          <span class="text-xs text-gray-500">${formatDate(ban.created_at)}</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">
                          Ù…Ø¯Øª: ${ban.duration_minutes} Ø¯Ù‚ÛŒÙ‚Ù‡
                        </p>
                      </div>
                    `).join('')}
                  </div>
                </div>
              `;
            }
          } catch (e) {
            console.error('Error loading ban history:', e);
          }
          
          const modalHTML = `
            <div class="modal-overlay" onclick="closeModal(event)">
              <div class="modal-content max-w-3xl" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-6">
                  <div class="flex items-center gap-3">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-2xl font-bold">
                      ${user.name.charAt(0)}
                    </div>
                    <div>
                      <h3 class="text-2xl font-bold">${user.name}</h3>
                      <p class="text-gray-500 font-mono">${user.id}</p>
                    </div>
                  </div>
                  <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                  </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ -->
                  <div>
                    <h4 class="font-bold mb-3">ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ</h4>
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-500">Ø³Ú©Ù‡:</span>
                        <span class="font-bold">${formatNumber(user.coins)}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-500">Ø¬Ù…:</span>
                        <span class="font-bold gem-badge">${user.gem || 0}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-500">Ø´ØºÙ„:</span>
                        <span class="font-bold">${user.job}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-500">Ø³Ø·Ø­:</span>
                        <span class="font-bold">${user.level}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-500">ØªØ¬Ø±Ø¨Ù‡:</span>
                        <span class="font-bold">${formatNumber(user.experience)}</span>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨ -->
                  <div>
                    <h4 class="font-bold mb-3">ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨</h4>
                    <div class="space-y-3">
                      <div class="flex justify-between">
                        <span class="text-gray-500">ÙˆØ¶Ø¹ÛŒØª:</span>
                        <span class="${user.active ? 'text-green-600' : 'text-red-600'} font-bold">
                          ${user.active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-500">Ù†Ù‚Ø´:</span>
                        <span class="${user.is_admin ? 'text-purple-600' : 'text-gray-600'} font-bold">
                          ${user.is_admin ? 'Ø§Ø¯Ù…ÛŒÙ†' : 'Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ'}
                        </span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-500">Ú©Ø¯ Ø¯Ø¹ÙˆØª:</span>
                        <span class="font-mono font-bold">${user.referral_code || '-'}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-500">ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯:</span>
                        <span class="font-bold">${formatDate(user.created_at)}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-500">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯:</span>
                        <span class="font-bold">${formatDate(user.last_login)}</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                ${banInfo}
                ${banHistory}
                
                <!-- ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§ -->
                <div class="mt-6">
                  <h4 class="font-bold mb-3">ğŸ“› ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§</h4>
                  <div class="space-y-2 max-h-48 overflow-y-auto">
                    ${user.name_history && user.name_history.length > 0 ? 
                      user.name_history.map(name => `
                        <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                          <div class="flex justify-between items-center">
                            <span class="font-medium">${name.name}</span>
                            <span class="text-xs text-gray-500">${formatISODate(name.timestamp)}</span>
                          </div>
                        </div>
                      `).join('') :
                      '<p class="text-gray-500 text-center py-4">Ù‡ÛŒÚ† ØªØ§Ø±ÛŒØ®Ú†Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>'
                    }
                  </div>
                </div>
                
                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª -->
                <div class="flex gap-3 mt-8 pt-6 border-t">
                  <button onclick="editUser('${user.id}')" 
                          class="flex-1 bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-edit ml-2"></i> ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±
                  </button>
                  <button onclick="showBanModal('${user.id}', '${user.name}')" 
                          class="flex-1 ${isBanned ? 'bg-green-600 hover:bg-green-700' : 'btn-danger'} text-white p-3 rounded-lg">
                    <i class="fas ${isBanned ? 'fa-unlock' : 'fa-ban'} ml-2"></i>
                    ${isBanned ? 'Ø­Ø°Ù Ø¨Ù†' : 'Ø¨Ù† Ú©Ø±Ø¯Ù†'}
                  </button>
                </div>
              </div>
            </div>
          `;
          
          document.getElementById('modalContainer').innerHTML = modalHTML;
          document.getElementById('modalContainer').classList.remove('hidden');
        }
      } catch (error) {
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±', 'error');
      }
    }

    // Modal Ø¨Ù† Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±
    function showBanModal(userId, userName) {
      const modalHTML = `
        <div class="modal-overlay" onclick="closeModal(event)">
          <div class="modal-content max-w-md" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold">ğŸ”¨ Ø¨Ù† Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±</h3>
              <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>
            
            <div class="mb-6">
              <p class="text-gray-600 dark:text-gray-400">
                Ú©Ø§Ø±Ø¨Ø±: <span class="font-bold">${userName}</span>
              </p>
              <p class="text-sm text-gray-500 mt-1">Ø´Ù†Ø§Ø³Ù‡: ${userId}</p>
            </div>
            
            <div class="space-y-4">
              <div>
                <label class="block mb-2 font-medium">Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¨Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                <input id="banMinutes" type="number" min="0" 
                       value="60" class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700">
                <p class="text-xs text-gray-500 mt-1">Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø¨Ù†ØŒ Ø¹Ø¯Ø¯ 0 ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
              </div>
              
              <div>
                <label class="block mb-2 font-medium">Ø´Ù†Ø§Ø³Ù‡ Ø¨Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                <input id="bannedBy" type="text" 
                       placeholder="Ø´Ù†Ø§Ø³Ù‡ Ø§Ø¯Ù…ÛŒÙ†"
                       class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-700">
              </div>
              
              <div class="grid grid-cols-3 gap-2 mt-4">
                <button onclick="setBanTime(15)" class="p-2 bg-gray-100 dark:bg-gray-700 rounded">
                  15 Ø¯Ù‚ÛŒÙ‚Ù‡
                </button>
                <button onclick="setBanTime(60)" class="p-2 bg-gray-100 dark:bg-gray-700 rounded">
                  1 Ø³Ø§Ø¹Øª
                </button>
                <button onclick="setBanTime(1440)" class="p-2 bg-gray-100 dark:bg-gray-700 rounded">
                  1 Ø±ÙˆØ²
                </button>
              </div>
            </div>
            
            <div class="flex gap-3 mt-8">
              <button onclick="performBan('${userId}')" 
                      class="flex-1 btn-danger p-3 rounded-lg font-semibold">
                <i class="fas fa-hammer ml-2"></i> Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù†
              </button>
              <button onclick="closeModal()" 
                      class="flex-1 bg-gray-600 text-white p-3 rounded-lg hover:bg-gray-700 font-semibold">
                Ø§Ù†ØµØ±Ø§Ù
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('modalContainer').innerHTML = modalHTML;
      document.getElementById('modalContainer').classList.remove('hidden');
    }

    // ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ø¨Ù†
    function setBanTime(minutes) {
      document.getElementById('banMinutes').value = minutes;
    }

    // Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ù†
    async function performBan(userId) {
      const minutes = parseInt(document.getElementById('banMinutes').value);
      const bannedBy = document.getElementById('bannedBy').value || 'Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…';
      
      if (isNaN(minutes) || minutes < 0) {
        showNotification('Ù„Ø·ÙØ§Ù‹ Ø²Ù…Ø§Ù† Ø¨Ù† Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
        return;
      }
      
      const action = minutes === 0 ? 'Ø­Ø°Ù Ø¨Ù†' : `Ø¨Ù† Ø¨Ø±Ø§ÛŒ ${minutes} Ø¯Ù‚ÛŒÙ‚Ù‡`;
      if (!confirm(`Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ${action} Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯ØŸ`)) {
        return;
      }
      
      try {
        const response = await fetch(API_BASE + '/ban', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            id: userId, 
            duration_minutes: minutes,
            banned_by: bannedBy
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          showNotification(minutes === 0 ? 'Ø¨Ù† Ú©Ø§Ø±Ø¨Ø± Ø­Ø°Ù Ø´Ø¯' : 'Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù† Ø´Ø¯', 'success');
          closeModal();
          loadStats();
          loadUsers();
        } else {
          const error = await response.json();
          showNotification(error.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù† Ú©Ø±Ø¯Ù†', 'error');
        }
      } catch (error) {
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
      }
    }

    // =================================================================
    // ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
    // =================================================================

    // ÙØ±Ù…Øª Ø§Ø¹Ø¯Ø§Ø¯
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® Unix
    function formatDate(timestamp) {
      if (!timestamp || timestamp === 0) return '---';
      const date = new Date(timestamp * 1000);
      return date.toLocaleDateString('fa-IR');
    }

    // ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® ISO
    function formatISODate(isoString) {
      if (!isoString) return '---';
      const date = new Date(isoString);
      return date.toLocaleDateString('fa-IR') + ' ' + date.toLocaleTimeString('fa-IR');
    }

    // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
    function showNotification(message, type = 'success') {
      const container = document.getElementById('notificationContainer');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div class="flex items-center gap-3">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
          <p>${message}</p>
        </div>
        <button onclick="this.parentElement.remove()" class="absolute left-3 top-1/2 transform -translate-y-1/2">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      container.appendChild(notification);
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 5000);
    }

    // Ø¨Ø³ØªÙ† Modal
    function closeModal(event) {
      if (event && event.target.classList.contains('modal-overlay')) {
        document.getElementById('modalContainer').classList.add('hidden');
        document.getElementById('modalContainer').innerHTML = '';
      } else if (!event) {
        document.getElementById('modalContainer').classList.add('hidden');
        document.getElementById('modalContainer').innerHTML = '';
      }
    }

    // ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´
    function setViewMode(mode) {
      currentViewMode = mode;
      const usersContainer = document.getElementById('usersContainer');
      usersContainer.classList.remove('compact-mode', 'expanded-mode');
      usersContainer.classList.add(mode === 'compact' ? 'compact-mode' : 'expanded-mode');
      
      // Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
      document.getElementById('btnCompact').classList.toggle('selected', mode === 'compact');
      document.getElementById('btnExpanded').classList.toggle('selected', mode === 'expanded');
      
      updateUsersDisplay();
    }

    // ØªØºÛŒÛŒØ± Ù†ÙˆØ¹ Ù„ÛŒØ³Øª
    function setListView(type) {
      currentListView = type;
      const usersContainer = document.getElementById('usersContainer');
      usersContainer.classList.remove('view-mode-grid', 'view-mode-list');
      usersContainer.classList.add(type === 'grid' ? 'view-mode-grid' : 'view-mode-list');
      
      // Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ø¯Ø± Ø¬Ø¯ÙˆÙ„
      document.getElementById('tableHeader').classList.toggle('hidden', type === 'grid');
      
      // Ø¢Ù¾Ø¯ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
      document.getElementById('btnGrid').classList.toggle('selected', type === 'grid');
      document.getElementById('btnList').classList.toggle('selected', type === 'list');
      
      updateUsersDisplay();
    }

    // ØªØºÛŒÛŒØ± ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª
    function changePageSize(size) {
      currentPageSize = size === 'all' ? 'all' : parseInt(size);
      currentPage = 1;
      loadUsers();
    }

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Pagination
    function updatePagination() {
      const pageInfo = document.getElementById('pageInfo');
      const firstPageBtn = document.getElementById('firstPage');
      const prevPageBtn = document.getElementById('prevPage');
      const nextPageBtn = document.getElementById('nextPage');
      const lastPageBtn = document.getElementById('lastPage');
      const pagesContainer = document.querySelector('.flex.gap-1');
      
      if (currentPageSize === 'all') {
        pageInfo.textContent = `Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (${formatNumber(totalUsers)})`;
        firstPageBtn.disabled = true;
        prevPageBtn.disabled = true;
        nextPageBtn.disabled = true;
        lastPageBtn.disabled = true;
        pagesContainer.innerHTML = '';
        return;
      }
      
      pageInfo.textContent = `ØµÙØ­Ù‡ ${currentPage} Ø§Ø² ${totalPages} â€¢ ${formatNumber(totalUsers)} Ú©Ø§Ø±Ø¨Ø±`;
      
      // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
      firstPageBtn.disabled = currentPage === 1;
      prevPageBtn.disabled = currentPage === 1;
      nextPageBtn.disabled = currentPage === totalPages;
      lastPageBtn.disabled = currentPage === totalPages;
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ø§Øª
      pagesContainer.innerHTML = '';
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, startPage + 4);
      
      for (let i = startPage; i <= endPage; i++) {
        const button = document.createElement('button');
        button.className = `px-3 py-1 rounded-lg ${i === currentPage ? 'bg-blue-600 text-white' : 'bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600'}`;
        button.textContent = i;
        button.onclick = () => goToPage(i);
        pagesContainer.appendChild(button);
      }
    }

    // Ø±ÙØªÙ† Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ø´Ø®Øµ
    function goToPage(page) {
      if (page >= 1 && page <= totalPages && page !== currentPage) {
        currentPage = page;
        loadUsers();
      }
    }

    // ØµÙØ­Ù‡ Ù‚Ø¨Ù„ÛŒ
    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        loadUsers();
      }
    }

    // ØµÙØ­Ù‡ Ø¨Ø¹Ø¯ÛŒ
    function nextPage() {
      if (currentPage < totalPages) {
        currentPage++;
        loadUsers();
      }
    }

    // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
    function filterUsers(filter) {
      currentFilter = currentFilter === filter ? null : filter;
      updateUsersDisplay();
    }

    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±Ù‡Ø§
    function clearFilters() {
      currentFilter = null;
      currentSearch = '';
      document.getElementById('quickSearch').value = '';
      updateUsersDisplay();
    }

    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø±ÛŒØ¹
    document.getElementById('quickSearch').addEventListener('input', function(e) {
      currentSearch = e.target.value;
      updateUsersDisplay();
    });

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ù†Ø¬â€ŒÙ‡Ø§
    async function loadTreasures() {
      try {
        const response = await fetch(API_BASE + '/list_treasures');
        const data = await response.json();
        
        if (data.success) {
          const container = document.getElementById('treasuresList');
          let html = '';
          
          data.treasures.forEach(treasure => {
            html += `
              <div class="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-900 rounded-xl p-4 border border-purple-100 dark:border-gray-700">
                <div class="flex justify-between items-start mb-3">
                  <div>
                    <h4 class="font-bold text-lg">${treasure.name}</h4>
                    <p class="text-sm text-gray-500">Ø´Ù†Ø§Ø³Ù‡: ${treasure.id}</p>
                  </div>
                  <i class="fas fa-gem text-2xl text-purple-500"></i>
                </div>
                
                <div class="space-y-3">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-600">Ø³Ú©Ù‡ Ø¬Ø§ÛŒØ²Ù‡:</span>
                    <span class="font-bold text-yellow-600">${formatNumber(treasure.coins_reward)}</span>
                  </div>
                  
                  <div class="flex justify-between items-center">
                    <span class="text-gray-600">Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø±:</span>
                    <span class="font-bold">${treasure.timer_duration_seconds} Ø«Ø§Ù†ÛŒÙ‡</span>
                  </div>
                  
                  <div class="flex gap-2 mt-4">
                    <button onclick="editTreasure(${treasure.id})" 
                            class="flex-1 bg-blue-600 text-white p-2 rounded-lg text-sm">
                      ÙˆÛŒØ±Ø§ÛŒØ´
                    </button>
                    <button onclick="deleteTreasure(${treasure.id})" 
                            class="flex-1 bg-red-600 text-white p-2 rounded-lg text-sm">
                      Ø­Ø°Ù
                    </button>
                  </div>
                </div>
              </div>
            `;
          });
          
          container.innerHTML = html;
        }
      } catch (error) {
        console.error('Error loading treasures:', error);
      }
    }

    // ØªØ§Ø¨Ø¹â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± (Ù…Ø®ØªØµØ± Ø´Ø¯Ù‡)
    function showAllUsers() { loadUsers(); }
    function showTopCoins() { window.location.hash = 'top'; }
    function showBannedUsers() { filterUsers('banned'); }
    function showAdminList() { filterUsers('admin'); }
    function showBanHistory() { showNotification('Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯', 'warning'); }
    function refreshUsers() { loadUsers(); showNotification('Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success'); }
    function exportUsers() { showNotification('Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯', 'warning'); }
    function showUserProfile() { showNotification('Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ù…Ø¯ÛŒØ±', 'info'); }
    function logout() { 
      if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø§Ø±Ø¬ Ù…ÛŒâ€ŒØ´ÙˆÛŒØ¯ØŸ')) {
        location.reload();
      }
    }

    // =================================================================
    // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    // =================================================================

    // Ø±ÙˆÛŒØ¯Ø§Ø¯ ØªØºÛŒÛŒØ± ØªÙ…
    document.getElementById('themeToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
      document.querySelector('#themeToggle i').className = document.body.classList.contains('dark') ? 'fas fa-sun' : 'fas fa-moon';
    });

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ… Ø§Ø² localStorage
    if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.body.classList.add('dark');
      document.querySelector('#themeToggle i').className = 'fas fa-sun';
    }

    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„ enter Ø¯Ø± ÙÛŒÙ„Ø¯ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
    document.getElementById('adminPassword').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        authenticate();
      }
    });
  </script>
</body>
</html>
