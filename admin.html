<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§Ø²ÛŒ</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
  :root {
    --primary: #6366f1;
    --danger: #ef4444;
    --success: #10b981;
    --dark: #1f2937;
    --light: #f9fafb;
  }
  .dark { background: #111827; color: #e5e7eb; }
  .card { transition: all 0.3s; cursor: pointer; }
  .card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); }
  .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
  .hidden { display: none; }
  .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 999; display: flex; justify-content: center; align-items: center; }
  .modal-content { background: #fff; padding: 24px; border-radius: 16px; max-width: 90%; max-height: 90%; overflow-y: auto; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
  .modal-dark { background: #1f2937; color: #e5e7eb; }
  
  /* ÙÙ‚Ø· Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ù† Ù‚Ø±Ù…Ø² Ø¨Ø´Ù† (Ø¯Ø³ØªÙ‡â€ŒØ¬Ù…Ø¹ÛŒ + Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„) */
  #btnShowBulkBan,
  #btnShowListBanned {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
  }
  #btnShowBulkBan:hover,
  #btnShowListBanned:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
    transform: translateY(-4px);
  }

  /* Ø¯Ø§Ø±Ú© Ù…ÙˆØ¯: Ù‚Ø±Ù…Ø² ØªÛŒØ±Ù‡ Ùˆ Ø®ÙˆØ§Ù†Ø§ */
  .dark #btnShowBulkBan,
  .dark #btnShowListBanned {
    background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%) !important;
  }
  .dark #btnShowBulkBan:hover,
  .dark #btnShowListBanned:hover {
    background: linear-gradient(135deg, #7f1d1d 0%, #450a0a 100%) !important;
  }

  /* Ú©Ø§Ø±Øª Ø¨Ù†â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§ Ù…Ø«Ù„ Ù‚Ø¨Ù„ Ø¨Ù…ÙˆÙ†Ù‡ (Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ù†Ø¯Ù‡) */
  #cardBannedNow { /* Ø¨Ø¯ÙˆÙ† !important Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ */ }

  /* Ù„ÛŒØ³Øª Ø¨Ù†â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø§Ø®Ù„ Ù…ÙˆØ¯Ø§Ù„ (Ù‚Ø±Ù…Ø² Ø´ÛŒÚ©) */
  .modal-content li.bg-red-50,
  .modal-content li[class*="bg-red"] {
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%) !important;
    border-left: 6px solid #ef4444 !important;
    color: #991b1b !important;
  }
  .dark .modal-content li.bg-red-50,
  .dark .modal-content li[class*="bg-red"] {
    background: linear-gradient(135deg, #450a0a 0%, #4c0519 100%) !important;
    border-left: 6px solid #f87171 !important;
    color: #fca5a5 !important;
  }
  .dark .modal-content li.bg-red-50 * { color: #fca5a5 !important; }

  /* gem badge */
  .gem-badge {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: bold;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }
  
  /* notification */
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 20px;
    border-radius: 8px;
    color: white;
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
  }
  .notification.success { background: linear-gradient(135deg, #10b981, #059669); }
  .notification.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
  .notification.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  /* Ø§Ø³Ú©Ø±ÙˆÙ„Ø¨Ø§Ø± Ø´ÛŒÚ© */
  ::-webkit-scrollbar { width: 10px; }
  ::-webkit-scrollbar-track { background: #f3f4f6; border-radius: 10px; }
  ::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 10px; }
  .dark ::-webkit-scrollbar-track { background: #374151; }
  .dark ::-webkit-scrollbar-thumb { background: #6b7280; }
</style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen transition-colors"> 
  <div class="container mx-auto p-4 max-w-7xl"> 
    <header class="text-center mb-8"> 
      <h1 class="text-4xl font-bold gradient-bg bg-clip-text text-transparent">ğŸ® Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§Ø²ÛŒ</h1> 
      <p class="text-gray-600 dark:text-gray-400 mt-2">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†, Ø³Ú©Ù‡, Ø¬Ù…, Ø¨Ù† Ùˆ Ú¯Ù†Ø¬â€ŒÙ‡Ø§</p> 
      <button id="themeToggle" class="mt-4 p-2 rounded-full bg-gray-200 dark:bg-gray-700"> 
        <i class="fas fa-moon"></i> 
      </button> 
    </header> 
    
    <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± (6 Ú©Ø§Ø±Øª) --> 
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8"> 
      <div id="cardTotalUsers" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">ğŸ‘¥ Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</p> 
          <p id="totalUsers" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-users text-4xl text-indigo-400 mt-4"></i> 
      </div> 
      <div id="cardTotalActive" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">âœ… Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„</p> 
          <p id="totalActive" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-user-check text-4xl text-green-400 mt-4"></i> 
      </div> 
      <div id="cardNewToday" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">ğŸ†• Ø¬Ø¯ÛŒØ¯ Ø§Ù…Ø±ÙˆØ²</p> 
          <p id="newToday" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-user-plus text-4xl text-yellow-400 mt-4"></i> 
      </div> 
      <div id="cardTotalCoins" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">ğŸ’° Ú©Ù„ Ø³Ú©Ù‡â€ŒÙ‡Ø§</p> 
          <p id="totalCoins" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-coins text-4xl text-amber-400 mt-4"></i> 
      </div> 
      <div id="cardTotalGems" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">ğŸ’ Ú©Ù„ Ø¬Ù…â€ŒÙ‡Ø§</p> 
          <p id="totalGems" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-gem text-4xl text-purple-400 mt-4"></i> 
      </div> 
      <div id="cardBannedNow" class="card bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg"> 
        <div> 
          <p class="text-sm text-gray-500 dark:text-gray-400">ğŸ”¨ Ø¨Ù† Ø´Ø¯Ù‡â€ŒÙ‡Ø§</p> 
          <p id="bannedNow" class="text-3xl font-extrabold mt-1">...</p> 
        </div> 
        <i class="fas fa-ban text-4xl text-red-400 mt-4"></i> 
      </div> 
    </div> 
    
    <!-- Ø¨Ø®Ø´ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹ --> 
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8"> 
      <button id="btnShowRecentChats" class="bg-gradient-to-r from-blue-500 to-blue-700 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition"> 
        <i class="fas fa-comments ml-2"></i> Ú†Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± 
      </button> 
      <button id="btnShowBulkBan" class="bg-gradient-to-r from-red-500 to-red-700 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition"> 
        <i class="fas fa-users-slash ml-2"></i> Ø¨Ù† Ù¾ÛŒØ´Ø±ÙØªÙ‡ 
      </button> 
      <button onclick="showJobSearchModal()" class="bg-gradient-to-r from-green-500 to-green-700 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition"> 
        <i class="fas fa-briefcase ml-2"></i> Ø¬Ø³ØªØ¬ÙˆÛŒ Ø´ØºÙ„ 
      </button> 
      <button onclick="showConvertCurrencyModal()" class="bg-gradient-to-r from-purple-500 to-purple-700 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition"> 
        <i class="fas fa-exchange-alt ml-2"></i> ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø² 
      </button> 
    </div> 
    
    <!-- Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ù†Ø¬â€ŒÙ‡Ø§ --> 
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-8"> 
      <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-gem ml-2"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ù†Ø¬â€ŒÙ‡Ø§</h2> 
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Ù…Ù‚Ø¯Ø§Ø± Ø³Ú©Ù‡ Ùˆ Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø± (Ø¨Ù‡ Ø«Ø§Ù†ÛŒÙ‡) Ù‡Ø± Ú¯Ù†Ø¬ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.</p> 
      <div class="mb-4 flex flex-col md:flex-row gap-4"> 
        <input id="newTreasureName" type="text" placeholder="Ù†Ø§Ù… Ú¯Ù†Ø¬ Ø¬Ø¯ÛŒØ¯" class="flex-grow p-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"/> 
        <input id="newTreasureCoins" type="number" placeholder="Ø³Ú©Ù‡ Ø¬Ø§ÛŒØ²Ù‡" class="w-full md:w-28 p-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"/> 
        <input id="newTreasureDuration" type="number" placeholder="Ø²Ù…Ø§Ù† (Ø«Ø§Ù†ÛŒÙ‡)" class="w-full md:w-28 p-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"/> 
        <button onclick="addTreasure()" class="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition w-full md:w-auto flex items-center justify-center"> 
          <i class="fas fa-plus ml-2"></i> Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú¯Ù†Ø¬ 
        </button> 
      </div> 
      <div class="overflow-x-auto"> 
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"> 
          <thead class="bg-gray-50 dark:bg-gray-700"> 
            <tr> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ID Ú¯Ù†Ø¬</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ù†Ø§Ù…</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø³Ú©Ù‡ Ø¬Ø§ÛŒØ²Ù‡</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø²Ù…Ø§Ù† (Ø«Ø§Ù†ÛŒÙ‡)</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø¹Ù…Ù„ÛŒØ§Øª</th> 
            </tr> 
          </thead> 
          <tbody id="treasureListBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"> 
            <tr><td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400">Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ù†Ø¬â€ŒÙ‡Ø§...</td></tr> 
          </tbody> 
        </table> 
      </div> 
    </div> 
    
    <!-- Ø¬Ø³ØªØ¬Ùˆ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø± --> 
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-8"> 
      <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-search ml-2"></i> Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ú©Ø§Ø±Ø¨Ø±</h2> 
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ù†Ø§Ù… ÛŒØ§ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø´Ù†Ø§Ø³Ù‡ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯. Ø§Ú¯Ø± Ú†Ù†Ø¯ Ù†ØªÛŒØ¬Ù‡ Ø¨ÙˆØ¯ØŒ Ù‡Ù…Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p> 
      <div class="flex flex-col md:flex-row gap-4"> 
        <input id="userSearchInput" type="text" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø´Ù†Ø§Ø³Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." class="flex-grow p-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition"/> 
        <button onclick="searchUsers()" class="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition w-full md:w-auto flex items-center justify-center"> 
          <i class="fas fa-search ml-2"></i> Ø¬Ø³ØªØ¬Ùˆ 
        </button> 
      </div> 
      <!-- Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ --> 
      <div id="searchResults" class="hidden mt-4"> 
        <h3 class="font-bold mb-2">Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ:</h3> 
        <div id="searchResultsList" class="space-y-2"></div> 
      </div> 
    </div> 
    
    <!-- Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø± --> 
    <div id="userDetails" class="hidden bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-8"> 
      <h2 class="text-2xl font-bold mb-4 text-indigo-600 dark:text-indigo-400 flex items-center"><i class="fas fa-user-circle ml-2"></i> Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø±: <span id="userName" class="mr-1"></span></h2> 
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6"> 
        <div class="col-span-1 md:col-span-4 border-b pb-4 mb-4"> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ø´Ù†Ø§Ø³Ù‡: <span id="detailId" class="text-gray-900 dark:text-white font-mono text-sm"></span></p> 
          <p class="text-sm text-gray-500 dark:text-gray-400">ØªØ§Ø±ÛŒØ® Ø³Ø§Ø®Øª: <span id="detailCreatedAt" class="text-gray-900 dark:text-white text-sm"></span></p> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯: <span id="detailLastLogin" class="text-gray-900 dark:text-white text-sm"></span></p> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ú©Ø¯ Ø¯Ø¹ÙˆØª: <span id="detailReferral" class="text-gray-900 dark:text-white font-mono text-sm"></span></p> 
          <p class="text-sm text-gray-500 dark:text-gray-400 flex items-center"> ÙˆØ¶Ø¹ÛŒØª: <span id="detailActive" class="mr-1 font-bold"></span> <span id="detailAdmin" class="text-xs mr-2 p-1 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"></span> </p> 
          <p class="text-sm text-gray-500 dark:text-gray-400">Ø¨Ù† ØªØ§: <span id="detailBan" class="text-red-500 font-bold"></span></p> 
        </div> 
        <div class="p-4 border dark:border-gray-700 rounded-lg col-span-1 md:col-span-2"> 
          <h3 class="font-semibold mb-3">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØµÙ„ÛŒ (Ù†Ø§Ù…, Ø³Ú©Ù‡, Ø¬Ù…, Ø´ØºÙ„)</h3> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯ (<span id="currentName"></span>)</label> 
            <input id="editName" type="text" placeholder="Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯ (Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯)" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ø³Ú©Ù‡â€ŒÙ‡Ø§ (<span id="currentCoins">0</span>)</label> 
            <input id="editCoins" type="number" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø³Ú©Ù‡" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ø¬Ù…â€ŒÙ‡Ø§ (<span id="currentGems">0</span>)</label> 
            <input id="editGems" type="number" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø¬Ù…" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ø´ØºÙ„ (<span id="currentJob">Ø¨ÛŒÚ©Ø§Ø±</span>)</label> 
            <input id="editJob" type="text" placeholder="Ø´ØºÙ„ Ø¬Ø¯ÛŒØ¯" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <button onclick="updateUserInfo()" class="bg-green-600 text-white p-2 rounded-lg hover:bg-green-700 transition w-full mt-2"> 
            <i class="fas fa-save ml-2"></i> Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª 
          </button> 
          <button onclick="showConvertCurrencyModalForUser()" class="bg-purple-600 text-white p-2 rounded-lg hover:bg-purple-700 transition w-full mt-2"> 
            <i class="fas fa-exchange-alt ml-2"></i> ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø² 
          </button> 
          <button onclick="showNameHistory()" class="bg-gray-600 text-white p-2 rounded-lg hover:bg-gray-700 transition w-full mt-2"> 
            <i class="fas fa-history ml-2"></i> ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§ 
          </button> 
        </div> 
        <div class="p-4 border dark:border-gray-700 rounded-lg"> 
          <h3 class="font-semibold mb-3">Ø³Ø·Ø­/ØªØ¬Ø±Ø¨Ù‡</h3> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ø³Ø·Ø­ (<span id="currentLevel">1</span>)</label> 
            <input id="editLevel" type="number" placeholder="Ø³Ø·Ø­ Ø¬Ø¯ÛŒØ¯" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">ØªØ¬Ø±Ø¨Ù‡ (<span id="currentExp">0</span>)</label> 
            <input id="editExp" type="number" placeholder="ØªØ¬Ø±Ø¨Ù‡ Ø¬Ø¯ÛŒØ¯" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <button onclick="updateLevelExp()" class="bg-yellow-600 text-white p-2 rounded-lg hover:bg-yellow-700 transition w-full mt-2"> 
            <i class="fas fa-level-up-alt ml-2"></i> Ø°Ø®ÛŒØ±Ù‡ Ø³Ø·Ø­/ØªØ¬Ø±Ø¨Ù‡ 
          </button> 
          <button onclick="showTransferDataModal()" class="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition w-full mt-2"> 
            <i class="fas fa-people-arrows ml-2"></i> Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡ 
          </button> 
        </div> 
        <div class="p-4 border border-red-300 dark:border-red-700 rounded-lg bg-red-50 dark:bg-red-900"> 
          <h3 class="font-semibold mb-3 text-red-600 dark:text-red-400">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ/Ú†Øª</h3> 
          <button onclick="showChatHistory()" class="bg-indigo-700 text-white p-2 rounded-lg hover:bg-indigo-800 transition w-full mb-3"> 
            <i class="fas fa-comments ml-2"></i> Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª 
          </button> 
          <hr class="my-3 border-red-500 dark:border-red-600"> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¨Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</label> 
            <input id="banMinutes" type="number" placeholder="Ù…Ø«Ø§Ù„: 240 (4 Ø³Ø§Ø¹Øª)" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <div class="mb-3"> 
            <label class="block text-sm font-medium mb-1">Ø´Ù†Ø§Ø³Ù‡ Ø¨Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label> 
            <input id="bannedBy" type="text" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ø§Ø¯Ù…ÛŒÙ†" class="w-full p-2 border dark:border-gray-600 dark:bg-gray-700 rounded-md"/> 
          </div> 
          <button onclick="banUser()" class="bg-red-600 text-white p-2 rounded-lg hover:bg-red-700 transition w-full mt-2"> 
            <i class="fas fa-hammer ml-2"></i> Ø§Ø¹Ù…Ø§Ù„ Ø¨Ù† 
          </button> 
          <button onclick="unbanUser()" class="bg-gray-600 text-white p-2 rounded-lg hover:bg-gray-700 transition w-full mt-2"> 
            <i class="fas fa-undo-alt ml-2"></i> Ø­Ø°Ù Ø¨Ù† 
          </button> 
          <button onclick="toggleAdmin()" class="bg-yellow-800 text-white p-2 rounded-lg hover:bg-yellow-900 transition w-full mt-2"> 
            <i class="fas fa-user-shield ml-2"></i> ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø§Ø¯Ù…ÛŒÙ† 
          </button> 
          <button onclick="toggleActive()" class="bg-purple-800 text-white p-2 rounded-lg hover:bg-purple-900 transition w-full mt-2"> 
            <i class="fas fa-power-off ml-2"></i> ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† 
          </button> 
          <button onclick="deleteUser()" class="bg-red-800 text-white p-2 rounded-lg hover:bg-red-900 transition w-full mt-4"> 
            <i class="fas fa-trash-alt ml-2"></i> Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø± (ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª) 
          </button> 
        </div> 
      </div> 
    </div> 
    
    <!-- Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø®ÛŒØ± --> 
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg"> 
      <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-table ml-2"></i> Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø®ÛŒØ± (<span id="userCount">...</span>)</h2> 
      <div class="overflow-x-auto"> 
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"> 
          <thead class="bg-gray-50 dark:bg-gray-700"> 
            <tr> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ID / Ù†Ø§Ù…</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø³Ú©Ù‡ / Ø¬Ù…</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø³Ø·Ø­ / Ø´ØºÙ„</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ØªØ§Ø±ÛŒØ® Ø³Ø§Ø®Øª</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ÙˆØ¶Ø¹ÛŒØª</th> 
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ø¹Ù…Ù„ÛŒØ§Øª</th> 
            </tr> 
          </thead> 
          <tbody id="userListBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"> 
            <tr><td colspan="7" class="p-4 text-center text-gray-500 dark:text-gray-400">Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</td></tr> 
          </tbody> 
        </table> 
      </div> 
      <div class="flex justify-between items-center mt-4"> 
        <div id="pageInfo" class="text-sm text-gray-600 dark:text-gray-400"></div> 
        <div> 
          <button id="prevPageButton" class="px-4 py-2 text-sm font-medium rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition" disabled> Ù‚Ø¨Ù„ÛŒ </button> 
          <button id="nextPageButton" class="px-4 py-2 text-sm font-medium rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition mr-2" disabled> Ø¨Ø¹Ø¯ÛŒ </button> 
        </div> 
      </div> 
    </div> 
  </div> 
  <div id="modalContainer" class="hidden"></div>
  <div id="notificationContainer"></div>
  
  <script>
    const API_BASE = window.location.origin;
    let currentPage = 1;
    const limit = 20;
    let currentUserData = null;

    // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
    /** ØªÙˆÚ¯Ù„ Ø¯Ø§Ø±Ú© Ù…ÙˆØ¯ **/
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      document.querySelector('#themeToggle i').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
    });
    if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.body.classList.add('dark');
      document.querySelector('#themeToggle i').className = 'fas fa-sun';
    } else {
      document.querySelector('#themeToggle i').className = 'fas fa-moon';
    }

    /** Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† */
    function showNotification(message, type = 'success') {
      const container = document.getElementById('notificationContainer');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div class="flex items-center gap-2">
          <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}-circle"></i>
          <span>${message}</span>
        </div>
      `;
      container.appendChild(notification);
      setTimeout(() => notification.remove(), 5000);
    }

    /** ÙØ±Ù…Øª Ø§Ø¹Ø¯Ø§Ø¯ */
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    /** ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® Unix */
    function formatTimestamp(timestamp) {
      if (!timestamp || timestamp === 0) return '---';
      const date = new Date(timestamp * 1000);
      return date.toLocaleDateString('fa-IR') + ' ' + date.toLocaleTimeString('fa-IR');
    }

    /** ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® ISO */
    function formatISO(isoString) {
      if (!isoString) return '---';
      const date = new Date(isoString);
      return date.toLocaleDateString('fa-IR') + ' ' + date.toLocaleTimeString('fa-IR');
    }

    /** Ø§ÛŒØ¬Ø§Ø¯ Modal */
    function createModal(title, contentHTML) {
      const modalContainer = document.getElementById('modalContainer');
      modalContainer.innerHTML = '';
      modalContainer.classList.remove('hidden');
      const isDark = document.body.classList.contains('dark');
      const modalOverlay = document.createElement('div');
      modalOverlay.className = 'modal-overlay';
      const modalContent = document.createElement('div');
      modalContent.className = 'modal-content w-full md:w-3/4 ' + (isDark ? 'modal-dark' : 'bg-white');
      modalContent.innerHTML = '<div class="flex justify-between items-center border-b pb-3 mb-4">' +
        '<h3 class="text-xl font-bold ' + (isDark ? 'text-white' : 'text-gray-900') + '">' + title + '</h3>' +
        '<button onclick="closeModal()" class="text-gray-600 dark:text-gray-400 hover:text-red-500 transition">' +
          '<i class="fas fa-times text-xl"></i>' +
        '</button>' +
        '</div>' +
        '<div id="modalBody" class="max-h-96 overflow-y-auto">' + contentHTML + '</div>';
      modalOverlay.appendChild(modalContent);
      modalContainer.appendChild(modalOverlay);
    }

    function closeModal() {
      document.getElementById('modalContainer').classList.add('hidden');
      document.getElementById('modalContainer').innerHTML = '';
    }

    /** Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª API */
    async function runAction(endpoint, method = 'GET', body = null) {
      const options = { method: method, headers: { 'Content-Type': 'application/json' } };
      if (body) options.body = JSON.stringify(body);
      
      try {
        const response = await fetch(API_BASE + endpoint, options);
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({ error: 'Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±' }));
          throw new Error(errorData.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
        }
        return await response.json();
      } catch (error) {
        showNotification(error.message, 'error');
        throw error;
      }
    }

    // ==================== Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± ====================
    async function loadStats() {
      try {
        const data = await runAction('/stats');
        if (data.success) {
          const stats = data.stats;
          document.getElementById('totalUsers').textContent = formatNumber(stats.total_users);
          document.getElementById('totalActive').textContent = formatNumber(stats.active_users);
          document.getElementById('newToday').textContent = formatNumber(stats.new_today);
          document.getElementById('totalCoins').textContent = formatNumber(stats.total_coins);
          document.getElementById('totalGems').textContent = formatNumber(stats.total_gems || 0);
          document.getElementById('bannedNow').textContent = formatNumber(stats.banned_now);
        }
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    // ==================== Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ====================
    async function loadUserList(page = 1) {
      currentPage = page;
      const body = document.getElementById('userListBody');
      body.innerHTML = '<tr><td colspan="7" class="p-4 text-center"><i class="fas fa-spinner fa-spin ml-2"></i> Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†...</td></tr>';
      
      try {
        const data = await runAction(`/all_users?page=${page}&limit=${limit}`);
        if (data.success) {
          const users = data.users;
          const total = data.total;
          const totalPages = Math.ceil(total / limit);
          
          document.getElementById('userCount').textContent = formatNumber(total);
          document.getElementById('pageInfo').textContent = `ØµÙØ­Ù‡ ${page} Ø§Ø² ${totalPages} (Ú©Ù„: ${formatNumber(total)})`;
          document.getElementById('prevPageButton').disabled = (page <= 1);
          document.getElementById('nextPageButton').disabled = (page >= totalPages || totalPages === 0);
          
          body.innerHTML = '';
          if (users.length === 0) {
            body.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-gray-500 dark:text-gray-400">Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>';
            return;
          }
          
          users.forEach(user => {
            const activeStatus = user.active ? '<span class="text-green-500">ÙØ¹Ø§Ù„</span>' : '<span class="text-red-500">ØºÛŒØ±ÙØ¹Ø§Ù„</span>';
            const adminBadge = user.is_admin ? '<span class="text-xs mr-2 p-1 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">Ø§Ø¯Ù…ÛŒÙ†</span>' : '';
            const bannedBadge = user.ban_until > Math.floor(Date.now() / 1000) ? '<span class="text-xs mr-2 p-1 rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">Ø¨Ù†</span>' : '';
            const gemBadge = user.gem > 0 ? `<span class="gem-badge">${user.gem} Ø¬Ù…</span>` : '';
            
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition cursor-pointer';
            row.innerHTML = `
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="font-bold">${user.name}</span>
                <br>
                <span class="text-xs text-gray-500 dark:text-gray-400 font-mono">${user.id}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-yellow-600 font-bold">${formatNumber(user.coins)} Ø³Ú©Ù‡</div>
                ${gemBadge}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">Ø³Ø·Ø­ ${user.level}<br><span class="text-sm text-gray-500">${user.job}</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">${formatTimestamp(user.created_at)}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">${activeStatus} ${adminBadge} ${bannedBadge}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <button onclick="viewUserDetails('${user.id}')" class="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 font-medium">
                  <i class="fas fa-eye"></i> Ù…Ø´Ø§Ù‡Ø¯Ù‡
                </button>
              </td>
            `;
            body.appendChild(row);
          });
        }
      } catch (error) {
        body.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-red-500">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</td></tr>';
      }
    }

    // ==================== Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ====================
    async function searchUsers() {
      const query = document.getElementById('userSearchInput').value.trim();
      if (query.length < 2) {
        showNotification('Ø­Ø¯Ø§Ù‚Ù„ Û² Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'warning');
        return;
      }
      
      try {
        const data = await runAction(`/search_users?query=${encodeURIComponent(query)}`);
        if (data.success) {
          const users = data.users;
          const resultsDiv = document.getElementById('searchResults');
          const resultsList = document.getElementById('searchResultsList');
          
          if (users.length === 0) {
            resultsList.innerHTML = '<p class="text-center text-gray-500">Ù‡ÛŒÚ† Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>';
            resultsDiv.classList.remove('hidden');
            return;
          }
          
          resultsList.innerHTML = '';
          users.forEach(user => {
            const userCard = document.createElement('div');
            userCard.className = 'p-3 border dark:border-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition flex justify-between items-center';
            const activeStatus = user.active ? '<span class="text-green-500">ÙØ¹Ø§Ù„</span>' : '<span class="text-red-500">ØºÛŒØ±ÙØ¹Ø§Ù„</span>';
            const adminBadge = user.is_admin ? '<span class="text-xs mr-2 p-1 rounded-full bg-yellow-100 text-yellow-800">Ø§Ø¯Ù…ÛŒÙ†</span>' : '';
            const bannedBadge = user.ban_until > Math.floor(Date.now() / 1000) ? '<span class="text-xs mr-2 p-1 rounded-full bg-red-100 text-red-800">Ø¨Ù†</span>' : '';
            const gemBadge = user.gem > 0 ? `<span class="gem-badge">${user.gem} Ø¬Ù…</span>` : '';
            
            userCard.innerHTML = `
              <div>
                <p class="font-bold">${user.name} ${adminBadge} ${bannedBadge}</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">ID: ${user.id} | Ø³Ú©Ù‡: ${formatNumber(user.coins)} ${gemBadge} | Ø³Ø·Ø­: ${user.level}</p>
              </div>
              <button class="bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700 text-sm" onclick="viewUserDetails('${user.id}'); document.getElementById('searchResults').classList.add('hidden');">
                Ù…Ø´Ø§Ù‡Ø¯Ù‡
              </button>
            `;
            resultsList.appendChild(userCard);
          });
          resultsDiv.classList.remove('hidden');
        }
      } catch (error) {
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ', 'error');
      }
    }

    // ==================== Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø± ====================
    async function viewUserDetails(id) {
      const detailsDiv = document.getElementById('userDetails');
      detailsDiv.classList.remove('hidden');
      detailsDiv.scrollIntoView({ behavior: 'smooth' });
      
      try {
        const data = await runAction(`/user?id=${id}&skip_login_update=1`);
        if (data.success) {
          currentUserData = data.user;
          const user = data.user;
          const now = Math.floor(Date.now() / 1000);
          
          document.getElementById('userName').textContent = user.name;
          document.getElementById('detailId').textContent = user.id;
          document.getElementById('detailCreatedAt').textContent = formatTimestamp(user.created_at);
          document.getElementById('detailLastLogin').textContent = formatTimestamp(user.last_login);
          document.getElementById('detailReferral').textContent = user.referral_code;
          
          const activeEl = document.getElementById('detailActive');
          activeEl.textContent = user.active ? 'ÙØ¹Ø§Ù„' : 'ØºÛŒØ±ÙØ¹Ø§Ù„';
          activeEl.className = user.active ? 'text-green-600 font-bold mr-1' : 'text-red-600 font-bold mr-1';
          
          const adminEl = document.getElementById('detailAdmin');
          adminEl.textContent = user.is_admin ? 'Ø§Ø¯Ù…ÛŒÙ†' : '';
          adminEl.classList.toggle('hidden', !user.is_admin);
          
          const banEl = document.getElementById('detailBan');
          if (user.ban_until > now) {
            const remainingMinutes = Math.ceil((user.ban_until - now) / 60);
            banEl.textContent = 'ØªØ§ ' + user.ban_date + ' (Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒ: ' + remainingMinutes + ' Ø¯Ù‚ÛŒÙ‚Ù‡)';
            banEl.classList.add('text-red-500');
          } else {
            banEl.textContent = 'Ø¨Ù† Ù†ÛŒØ³Øª';
            banEl.classList.remove('text-red-500');
          }
          
          document.getElementById('currentName').textContent = user.name;
          document.getElementById('editName').value = user.name;
          document.getElementById('currentCoins').textContent = formatNumber(user.coins);
          document.getElementById('editCoins').value = user.coins;
          document.getElementById('currentGems').textContent = formatNumber(user.gem || 0);
          document.getElementById('editGems').value = user.gem || 0;
          document.getElementById('currentJob').textContent = user.job;
          document.getElementById('editJob').value = user.job;
          document.getElementById('currentLevel').textContent = formatNumber(user.level);
          document.getElementById('editLevel').value = user.level;
          document.getElementById('currentExp').textContent = formatNumber(user.experience);
          document.getElementById('editExp').value = user.experience;
        }
      } catch (error) {
        detailsDiv.classList.add('hidden');
        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±', 'error');
      }
    }

    // ==================== Ø¢Ù¾Ø¯ÛŒØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± ====================
    async function updateUserInfo() {
      if (!currentUserData) return;
      
      const id = currentUserData.id;
      const name = document.getElementById('editName').value;
      const coins = document.getElementById('editCoins').value;
      const gem = document.getElementById('editGems').value;
      const job = document.getElementById('editJob').value;
      
      try {
        const data = await runAction('/update', 'POST', {
          id: id,
          name: name,
          coins: parseInt(coins),
          gem: parseInt(gem),
          job: job
        });
        
        if (data.success) {
          showNotification('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯', 'success');
          viewUserDetails(id);
          loadStats();
          loadUserList(currentPage);
        }
      } catch (error) {
        // Ø®Ø·Ø§ ØªÙˆØ³Ø· runAction Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯
      }
    }

    async function updateLevelExp() {
      if (!
